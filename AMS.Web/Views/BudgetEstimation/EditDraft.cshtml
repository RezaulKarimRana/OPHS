@model AMS.Models.ServiceModels.BudgetEstimate.SingleEstimationWithTypeResponse
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
}
<style>
    select, option {
        width: 200px;
    }

    #TableAprroverList tbody {
        counter-reset: serial-number;
    }

        #TableAprroverList tbody td:first-child:before {
            counter-increment: serial-number;
            content: counter(serial-number);
        }

    #particularItemsDetails tbody {
        counter-reset: serial-number;
    }

        #particularItemsDetails tbody td:first-child:before {
            counter-increment: serial-number;
            content: counter(serial-number);
        }
    modal {
        font-size: 20px;
    }
</style>

<div class="hiddenElements">
    <input id="estimateId"
           type="hidden"
           value="@Model.Estimation.EstimateId" />
</div>
<div class="container-fluid">
    <form id="form">
        <div class="card border-secondary mb-4">
            <div class="card-header hideShow"><b>Edit Draft Estimate Your Budget Here</b></div>
            <div class="card-body">
                <div class="container-fluid">
                    <div class="form-group required row">
                        <label for="approvalForDropDown" class="col-sm-2 col-form-label-sm control-label">Approval For</label>
                        <div class="col-sm-4">
                            <select class="form-control" aria-label=".form-select-sm example" id="approvalForDropDown" required>
                                <option value="@Model.Estimation.EstimationTypeId" selected>@Model.Estimation.EstimationTypeName</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label for="IdentificationTextId" class="col-sm-2 col-form-label-sm control-label">Identification</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="IdentificationTextId" value="@Model.Estimation.EstimationIdentifier" disabled />
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label for="subjectTextId" class="col-sm-2 col-form-label-sm control-label">Subject</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="subjectTextId" required />
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="card secondary mb-4 procurementApprovalDiv">
            <div class="card-header hideShow"><b>Background</b></div>
            <div class="card-body">
                <div class="container-fluid">
                    <div class="form-group required row">
                        <label for="paReferenceNumberTextId" class="col-sm-2 col-form-label-sm control-label">PA. Reference No.</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="paReferenceNumberTextId" required />
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label for="titleOfPRorRFQTextId" class="col-sm-2 col-form-label-sm control-label">Title of the PR/RFQ</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="titleOfPRorRFQTextId" required />
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label for="RFQReferNoTextId" class="col-sm-2 col-form-label-sm control-label">RFQ Reference No.</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="RFQReferNoTextId" required />
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label for="PRReferenceNoTextId" class="col-sm-2 col-form-label-sm control-label">PR Reference No.</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="PRReferenceNoTextId" required />
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label for="NameAndCellRequesterTextId" class="col-sm-2 col-form-label-sm control-label">Name and Cell No. of Requester</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="nameAndCellRequesterTextId" required />
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label for="deptOrDivTextId" class="col-sm-2 col-form-label-sm control-label">Department/Division</label>
                        <div class="col-sm-10">
                            <select class="form-control" aria-label=".form-select-sm" id="deptOrDivTextId" required>
                                <option value="-1" selected>Select</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label for="RFQProcessTextId" class="col-sm-2 col-form-label-sm control-label">RFQ Process</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="RFQProcessTextId" required />
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label for="sourcingMethodTextId" class="col-sm-2 col-form-label-sm control-label">Sourcing Method</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="sourcingMethodTextId" required />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card secondary mb-4 procurementApprovalDiv">
            <div class="card-header hideShow"><b>Award Recommandation</b></div>
            <div class="card-body">
                <div class="container-fluid">
                    <div class="form-group required row">
                        <label for="nameSupplierTextId" class="col-sm-2 col-form-label-sm control-label">Name of the Recommended Supplied</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="nameSupplierTextId" required />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="purchaseValueTextId" class="col-sm-2 col-form-label-sm">Purchase Value</label>
                        <div class="col-sm-10">
                            <textarea class="form-control" id="purchaseValueTextId" style="height:200px;" aria-label="With textarea"></textarea>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="savingAmountTextId" class="col-sm-2 col-form-label-sm">Saving Amount</label>
                        <div class="col-sm-10">
                            <textarea class="form-control" id="savingAmountTextId" style="height:200px;" aria-label="With textarea"></textarea>
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label for="savingTypeDropDown" class="col-sm-2 col-form-label-sm control-label">Saving Type</label>
                        <div class="col-sm-4">
                            <select class="form-control" aria-label=".form-select-sm example" id="savingTypeDropDown" required>
                                <option value="None">Select</option>
                                <option value="CostAvoidance">Cost Avoidance</option>
                                <option value="CostReduction">Cost Reduction</option>
                                <option value="na">N/A</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card border-secondary mb-4">
            <div class="card-header hideShow"><b>Budget Descriptions</b></div>
            <div class="card-body">
                <div class="container-fluid">
                    <div class="form-group row">
                        <label for="objectiveTextId" class="col-sm-2 col-form-label-sm">Objective</label>
                        <div class="col-sm-10">
                            <textarea class="form-control" id="objectiveTextId" style="height:200px" aria-label="With textarea">@Model.Estimation.EstimationObjective</textarea>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="textEditorEstimation" class="col-sm-2 col-form-label-sm">Details</label>
                        <div class="col-sm-10">
                            <textarea id="textEditorEstimation" name="detailsData">@Model.Estimation.EstimationDetails</textarea>
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label class="col-sm-2 col-form-label-sm">Plan Date</label>
                        <div class="col-sm-4">
                            <label for="datetimepickerEstimationStartDate" class="col-form-label-sm control-label">Start</label>
                            <input readonly="readonly" id="datetimepickerEstimationStartDate" class="form-control datepicker" required />
                        </div>
                        <div class="col-sm-4">
                            <label for="datetimepickerEstimationEndDate" class="col-form-label-sm control-label">End</label>
                            <input readonly="readonly" id="datetimepickerEstimationEndDate" class="form-control datepicker" required />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="estimationfiles" class="col-sm-2 col-form-label-sm">Attachments</label>
                        <div class="col-sm-4">
                            <input type="file" class="form-control" id="estimationfiles" name="attachedFiles" multiple />
                        </div>
                        <div class="col-sm-6">
                            <table class="table table-sm">
                                <tr id="attachmentsTable"></tr>
                            </table>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-6">
                            <ul id="attachmentsTableNew"></ul>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-1"></div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="gridCheck" style="display:block;visibility:visible;width:auto;height:auto" checked>
                        </div>
                        <div class="col-sm-10">
                            <label class="form-check-label" for="gridCheck">
                                Add Particular line Items and details
                            </label>
                        </div>
                    </div>
                    <div class="form-group required row" id="totalPriceDiv">
                        <div class="col-md-6">
                            <div class="form-group required row">
                                <label for="currencyTypeDropDown" class="col-sm-4 col-form-label-sm control-label">Currency Type</label>
                                <div class="col-sm-8">
                                    <select class="form-control" aria-label=".form-select-sm example" id="currencyTypeDropDown" required>
                                        
                                      
                                        
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <label for="totalPriceText" class="col-sm-4 col-form-label-sm control-label">Total Price</label>
                                <div class="col-sm-8">
                                    <input type="number" step="0.01"class="form-control" id="totalPriceText" value="@Model.Estimation.EstimaionTotalPrice" required/>
                                </div>
                            </div>
                        </div>
                       
                        <div class="col-md-6">
                            <div class="row">
                                <label for="totalPrice_remarks" class="col-md-2 col-form-label-sm control-label"> Remarks</label>
                                <div class="col-md-10">
                                    <textarea class="form-control" id="total_price_remarks" aria-label="With textarea"> @Model.Estimation.TotalPriceRemarks</textarea>
                                </div>
                            </div>
                        </div>

                        
                    </div>
                </div>
            </div>
        </div>

        <div class="card border-secondary mb-4" id="AddParticularSection">
            <div class="card-header hideShow"><b>Particular Items and Details</b></div>
            <div class="card-body">
                <div>
                    <div class="container-fluid">
                        <div class="table-responsive" id="particularItemTableId">
                            <table class="table table-sm table-hover table-bordered particularItemsAndDetailsTable" id="particularItemsDetails">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>#</th>
                                        <th scope="col">Particular</th>
                                        <th scope="col">Item Category</th>
                                        <th scope="col">Item</th>
                                        <th scope="col">Item Code</th>
                                        <th scope="col">Unit</th>
                                        <th scope="col">No. Of Machine /Usages /Team /Car</th>
                                        <th scope="col">No. Of Day /Total Unit</th>
                                        <th scope="col">Required Quantity</th>
                                        <th scope="col">Unit Price</th>
                                        <th scope="col">Total Price (TK.)</th>
                                        <th scope="col">Responsible Department</th>
                                        <th scope="col">District</th>
                                        <th scope="col">Thana</th>
                                        <th scope="col">Area Type</th>
                                        <th scope="col">Remarks</th>
                                    </tr>
                                </thead>
                                <tbody id="tbody" style="text-align:left">
                                </tbody>
                                <tfoot align="right">
                                    <tr>
                                        <td colspan="4"><span id="validationMsgOnParticular" style="color:red"></span></td>
                                        <td id="sumOfTotalPrice" hidden>@Model.Estimation.EstimaionTotalPrice</td>
                                        <td colspan="7" style="font-weight:bold;" id="sumOfTotalPriceShow"></td>
                                        <td><span id="validationMsgOnDepartment" style="color:red"></span></td>
                                        <td colspan="2"><span id="validationMsgOnThana" style="color:red"></span></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-sm-1">
                                <button class="btn btn-primary form-control-sm" id="addBtn" type="button"><i class="fa fa-plus" aria-hidden="true">Row</i></button>
                            </div>
                            <div class="col-sm-6"></div>
                            <div class="col-sm-3 input-group">
                                <input type="search" placeholder="Item Code" id="itemCodeSearch" class="form-control-sm" style="width:65%" />
                                <div class="input-group-append">
                                    <button class="btn btn-info form-control-sm" id="addByCode" type="button" s><i class="fa fa-plus" aria-hidden="true">Item</i></button>
                                </div>
                                <label id="errorItemCodelabel" style="color:red"></label>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="container-fluid">
                        <div class="card border-secondary mb-4">
                            <div class="card-header"><b>Budget Summary View</b></div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-sm">
                                        <h6 style="text-align: center;">Department Wise Summary</h6>
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover table-bordered departmentWiseSummaryTable"
                                                   id="TableDepartmentWishSummary" style="float:left">
                                                <thead class="thead-dark">
                                                    <tr>
                                                        <th class="text-left" scope="col">Departments</th>
                                                        <th class="text-right" scope="col">Total Price (TK.)</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tDepartSummarybody" style="text-align:left">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-sm">
                                        <h6 style="text-align: center;">Particular Wise Summary</h6>
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover table-bordered particularWiseSummaryTable"
                                                   id="TableParticularWishSummary" style="float:left">
                                                <thead class="thead-dark">
                                                    <tr>
                                                        <th class="text-left" scope="col">Particulars</th>
                                                        <th class="text-right" scope="col">Total Price (TK.)</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tPartiSummarybody" style="text-align:left">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br />
        <div class="card secondary mb-4">
            <div class="card-header hideShow"><b>Approver Workflow Design </b></div>
            <div class="card-body">
                <div class="container-fluid" id="addApproverForm">
                    <div class="form-group required row">
                        <label for="employeeListforApprover" class="col-sm-2 col-form-label-sm control-label">Employee List</label>
                        <div class="col-sm-4">
                            <select class="form-control autoSuggestionSelect" aria-label=".form-select-sm example" id="employeeListforApprover" style="width:100%" required>
                                <option value="-1">Please Select Approver</option>
                            </select>
                        </div>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="userDepartmentID" disabled />
                            <input type="text" class="form-control" id="DeptIdUserID" hidden />
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label class="col-sm-2 col-form-label-sm" for="datetimepickerApproverTimeLine">Approver Role</label>
                        <div class="col-sm-4" id="sequenORparalllerRadioDiv">
                            <label class="btn btn-secondary" title="SEQUENCIAL or PARALLEL ??">
                                Flow >>>
                            </label>
                            <label class="btn btn-secondary" title="The approval request will process one by one in SEQUENCIAL mode.">
                                <input type="radio" class="btn btn-default" name="flow" value="Sequencial" checked />&nbsp;&nbsp;Sequencial
                            </label>
                            <label class="btn btn-secondary" title="The approval request will sent to all stakeholder during PARALLEL then will follow SEQUENCIAL mode.">
                                <input type="radio" class="btn btn-default" name="flow" value="Parallel" />&nbsp;&nbsp;Parallel
                            </label>
                        </div>
                        <div class="col-sm-6" id="approverTypeRadioDiv">
                            <label class="btn btn-secondary" title="Only for notification and view access, no parking and no action required.">
                                <input type="radio" class="btn btn-default" name="role" value="3" />&nbsp;&nbsp;Inform
                            </label>
                            <label class="btn btn-success" title="Will be pending to Recommendation end for input. Will go to next after recommendation input.">
                                <input type="radio" class="btn btn-default" name="role" value="2" checked />&nbsp;&nbsp;Recommend
                            </label>
                            <label class="btn btn-warning" id="finalApproverBtn" title="Will be pending to Recommendation end for input. This will be the last stage of the workflow. Only one person can be final approver.">
                                <input type="radio" class="btn btn-default" name="role" value="1" />&nbsp;&nbsp;Final Approve
                            </label>
                        </div>
                    </div>
                    <div class="form-group required row">
                        <label class="col-sm-2 col-form-label-sm" for="datetimepickerApproverTimeLine">Time Line</label>
                        <div class="col-sm-4">
                            <input readonly="readonly" id="datetimepickerApproverTimeLine" class="form-control datepicker" required />
                        </div>
                    </div>
                </div>
                <div class="container-fluid col-sm-3">
                    <button class="btn btn-secondary" id="addApprover" type="button">Add Approver</button>
                </div>
                <br />
                <div class="card secondary mb-4">
                    <div class="card-header"><b>Approver List </b></div>
                    <div class="card-body">
                        <div class="container-fluid">
                            <span id="app_err-container"></span>
                            <div class="table-responsive">
                                <table class="table table-sm table-hover table-bordered" id="TableAprroverList">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th>#</th>
                                            <th class="text-center" scope="col">Approver Name</th>
                                            <th class="text-center" scope="col">Approver Type</th>
                                            <th class="text-center" scope="col">Approver Department</th>
                                            <th class="text-center" scope="col">Expected Time</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tApproverbody" style="text-align:left">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br />
        <div class="container-fluid">
            <div class="form-group row" style="align-content:center">
                <div class="col-sm-5"></div>
                <div class="col-sm-7">
                    <button type="button" id="submitBudgeEstimation" class="btn btn-info btn-lg">
                        <i class="fa fa-eye" aria-hidden="true"></i> Preview
                    </button>
                    <button id="draftBudgeEstimation" class="btn btn-primary btn-lg" type="button">
                        <i class="fa fa-file" aria-hidden="true"></i> Draft
                    </button>
                    @Html.Hidden("RedirectToAllDraft", Url.Action("Index", "DraftedBudgeEstimation"))
                </div>
            </div>
        </div>
    </form>

    <!-- Modal -->
    <div class="modal fade bd-example-modal-xl" id="ApprovalPreviewModal" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Preview</h4>
                </div>
                <div class="modal-body">
                    <div align='center' style='font-family:Calibri; font-size:100%;' class="table-responsive">
                        <table class="table" id='previewHeader' width='100%' align='center' border='0' cellspacing='0' cellpadding='0' style=''>
                            <tbody>
                                <tr>
                                    <td>
                                        <!-- SComm Logo-->
                                        <table id='email-header-body' width='100%' align='center' border='0' cellspacing='0' cellpadding='0'>
                                            <tbody>
                                                <tr>
                                                    <td height='5' colspan='2' style='background-color:rgba(2,1,1,0.76)'></td>
                                                </tr>
                                                <tr>
                                                    <td id='top-left' width='50%' height='80' style='text-align:left;padding:10px 0 40px 20px'>
                                                        <img src='~/Files/SCommlogo(198_90).png' alt='Logo' border='0' width='200px' id='logo' class='CToWUd'>
                                                    </td>
                                                    <td id='top-right' width='50%' style='text-align:left;padding:0 30px 0 0'></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                            <tbody>
                        </table>
                        <div id="previewBody">

                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="finalSubmit"><i class="fa fa-paper-plane" aria-hidden="true"></i> Submit</button>
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts{
    <script src="~/js/AjaxCall/GetDataFromDbForBudetEstimationPage.js"></script>
    <script>

        $('.datepicker').datepicker({
            format: 'yyyy-mm-dd',
            autoclose: true
        });
        $('.datepicker').datepicker('update', new Date());
        $('.datepicker').datepicker()
            .on('changeDate',
                function(e) {
                    showErrorMessageBelowCtrl('datetimepickerEstimationStartDate', 'please select start date', false);
                    showErrorMessageBelowCtrl('datetimepickerEstimationEndDate', 'please select end date', false);

                    var planStartDate = $("#datetimepickerEstimationStartDate").val();
                    var planEndDate = $("#datetimepickerEstimationEndDate").val();

                    if (planStartDate.length <= 0) {
                        showErrorMessageBelowCtrl('datetimepickerEstimationStartDate', 'please select start date', true);
                    } else {
                        showErrorMessageBelowCtrl('datetimepickerEstimationStartDate', 'please select start date', false);
                    }

                    if (planEndDate.length <= 0) {
                        showErrorMessageBelowCtrl('datetimepickerEstimationEndDate', 'please select end date', true);
                    } else {
                        showErrorMessageBelowCtrl('datetimepickerEstimationEndDate', 'please select end date', false);
                    }
                });

        var rowIdx = 0;
        var storeItemDetails;
        var storeUsersWithDepartmentName;
        var tableOpen = 1;
        var formData;
        var filelist = [];
        var filetoDeleteFromDB = [0];
        var lastRecommenderPriority = 999;
        $(document).ready(function() {

            $(document).on('click',
                '#clearbtn',
                function() {
                    console.log('hh');
                    $("#form")[0].reset();
                });

            showErrorMessageBelowCtrl('datetimepickerEstimationStartDate', 'please select start date', false);
            showErrorMessageBelowCtrl('datetimepickerEstimationEndDate', 'please select end date', false);

            $('.procurementApprovalDiv').hide();
            $("#totalPriceDiv").hide();
            $('input[type="checkbox"]').click(function() {
                if ($(this).prop("checked") == true) {
                    $("#AddParticularSection").show(1000);
                    $("#totalPriceDiv").hide();
                    tableOpen = 1;
                } else if ($(this).prop("checked") == false) {
                    $("#AddParticularSection").hide("slow");
                    $("#totalPriceDiv").show(1000);
                    tableOpen = 0;
                }
            });

            //summerRichTextEditor
            $('#textEditorEstimation').summernote({
                placeholder: 'Estimation Details',
                tabsize: 2,
                height: 300,
                toolbar: [
                    ['style', ['style']],
                    ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                    ['fontname', ['fontname']],
                    ['fontsize', ['fontsize']],
                    ['color', ['color']],
                    ['para', ['ol', 'ul', 'paragraph', 'height']],
                    ['table', ['table']],
                    ['insert', ['link', 'picture', 'video']],
                    ['view', ['undo', 'redo', 'fullscreen', 'codeview', 'help']]
                ]
            });


            getParticularsFromDb(0);
            getDepartmentsFrmDb(0);
            getDepartmentsForDropDownFrmDb();
            getUserWithDepartmentNameSelect2FromDb();
            getEstimationSubjectNamesFromDb();
            getEstimateTypeFromDb();
            
            
            let estimateTypeValue = $("#approvalForDropDown").children("option:selected").val();
               
            getCurrencyTypeFromDbBasedOnEstimationTypeAndDropdownName("CurrencyType", estimateTypeValue);

            $('.autoSuggestionSelect').css('width', '100%');
            $(".autoSuggestionSelect").select2({});

            var estimationId = $("#estimateId").val();
            var selectValue = $("#approvalForDropDown").val();

            var formatter = new Intl.NumberFormat('en-IN',
                {
                    style: 'currency',
                    currency: 'BDT'
                });

            var totalPrice = $('#sumOfTotalPrice').text();
            var formatedtotalPrice = formatter.format(totalPrice);
            $('#sumOfTotalPriceShow').text(formatedtotalPrice);

            loadEstimation(estimationId);
            loadAttachments(estimationId);
            loadEstimationDetails(estimationId);
            loadEstimateApprovers(estimationId);
            loadSummariesOfThisEstimation(estimationId);
            if (selectValue == 7 || selectValue == 8) {

                setTimeout(function () {
                    $('.procurementApprovalDiv').show();
                loadProcurementApprovalEstimate(estimationId);
                }, 1300);
            }
            autoApproverAddorRemove();

            

            function loadEstimation(value) {
                $.ajax({
                    type: "GET",
                    url: "/Estimation/GetEstimationInfobyId?estimationId=" + value,
                    data: "{}",
                    success: function(data) {
                        console.log('Estimation c type ');
                        console.log(data.currencyType);
                        var estimation = data.estimation;
                        $("#subjectTextId").val(estimation.estimationSubject);
                        $("#datetimepickerEstimationEndDate").val(estimation.estimationPlanEndDate.slice(0, 10));
                        $("#datetimepickerEstimationStartDate").val(estimation.estimationPlanStartDate.slice(0, 10));
                        //var op = new Option(estimation.estimationTypeName, estimation.estimationTypeId,true,true);
                        //$(op).html(estimation.estimationTypeName);
                        //$("#approvalForDropDown").append(op);
                        
                        setTimeout(function() {
                            //console.log('Set timeout called' + estimation.currencyType);
                            $('#currencyTypeDropDown').val(estimation.currencyType).trigger("change");
                        }, 3000);
                     
                        
                        
                    }
                });
            }

            function loadProcurementApprovalEstimate(value) {
                $.ajax({
                    type: "GET",
                    url: "/Estimation/GetProcurementApprovalEstimationInfobyEstimateId?estimationId=" + value,
                    data: "{}",
                    success: function(data) {
                        console.log(data);
                        $("#paReferenceNumberTextId").val(data.paReferenceNo);
                        $("#titleOfPRorRFQTextId").val(data.titleOfPRorRFQ);
                        $("#RFQReferNoTextId").val(data.rfqReferenceNo);
                        $("#PRReferenceNoTextId").val(data.prReferenceNo);
                        $("#nameAndCellRequesterTextId").val(data.nameOfRequester);
                        //$('#deptOrDivTextId option[value=' + data.departmentId +']').attr('selected', 'selected');
                        $('#deptOrDivTextId').val(data.departmentId);
                        $("#RFQProcessTextId").val(data.rfqProcess);
                        $("#sourcingMethodTextId").val(data.sourcingMethod);
                        $("#nameSupplierTextId").val(data.nameOfRecommendedSupplier);
                        $("#purchaseValueTextId").val(data.purchaseValue);
                        $("#savingAmountTextId").val(data.savingAmount);
                        $('#savingTypeDropDown option[value=' + data.savingType + ']').attr('selected', 'selected');
                        //$("#savingTypeDropDown option").filter(function() {
                        //    return $(this).text() == data.savingType;
                        //}).prop('selected', true);
                    }
                });
            }

            function loadAttachments(value) {
                $.ajax({
                    type: "GET",
                    url: "/BudgetEstimation/LoadEstimateAttachmentsByEstimateId?estimateId=" + value,
                    data: "{}",
                    success: function(data) {
                        let attachment = data;
                        console.log(attachment);
                        for (var i = 0; i < attachment.length; i++) {
                            var str = attachment[i].url;

                            let index = str.indexOf('\\uploadedFiles\\NewFolder');
                            var res = str.substring(index);
                            console.log(res);

                            $('#attachmentsTable').append(
                                `<td><a href="` +
                                res +
                                `" download>` +
                                attachment[i].fileName +
                                `</a>
                                        <span class="removeAttachServer" id="` +
                                attachment[i].id +
                                `" style='font-size:15px;'>&#10060;</span></td>`
                            );
                        }
                    }
                });
            }

            function loadEstimationDetails(value) {

                var formatter = new Intl.NumberFormat('en-IN');
                $.ajax({
                    type: "GET",
                    url: "/DraftedBudgeEstimation/GetAllEstimationDetailsByEstimate?estiId=" + value,
                    data: "{}",
                    success: function(data) {
                        var details = data;
                        if (details.length < 1) {
                            $("#AddParticularSection").hide();
                            $("#totalPriceDiv").show();
                            tableOpen = 0;
                            $('input[type="checkbox"]').prop('checked', false);
                        } else {
                            for (var i = 0; i < details.length; i++) {
                                var deptId = details[i].departmentId;
                                var deptName = details[i].departmentName;
                                var formatedPrice = formatter.format(details[i].totalPrice);

                                $('#tbody').append(`<tr id="R${++rowIdx}">
                                    <td>&nbsp;</td>
                                    <td>
                                        <select class="particularSelectorFromTable" disabled>
                                            <option value="` +
                                    details[i].particularId +
                                    `" selected>` +
                                    details[i].particular +
                                    `</option></select></td>
                                    <td>
                                        <select class="itemCategoryDropdownSelector" disabled>
                                            <option selected>` +
                                    details[i].itemCategory +
                                    `</option></select></td>
                                    <td>
                                        <select class="itemSelectorFromTable" disabled>
                                            <option value="` +
                                    details[i].itemId +
                                    `" selected>` +
                                    details[i].itemName +
                                    `</option>
                                        </select></td>
                                    <td><span class="itemCodeText">` +
                                    details[i].itemCode +
                                    `</span></td>
                                    <td><span id="itemUnitTextId${rowIdx}" class="itemUnitText" style="color:chocolate">` +
                                    details[i].itemUnit +
                                    `</span></td>
                                    <td>
                                        <input type="text" class="findTotalPrice nomuct singleRowFindTotalPrice${rowIdx}" style="width:50px"
                                            id="NoOfMaUTCaTextId${rowIdx}" name="indexMAU"
                                                value="` +
                                    details[i].noOfMachineAndUsagesAndTeamAndCar +
                                    `"/></td>
                                    <td>
                                        <input type="text" class="onlyNumber findTotalPrice nodut singleRowFindTotalPrice${rowIdx}" style="width:50px"
                                            id="NoOfDTUTextId${rowIdx}" value="` +
                                    details[i].noOfDayAndTotalUnit +
                                    `"/>
                                    </td>
                                    <td>
                                        <input type="text" class="floatNumbersOnly findTotalPrice rqt singleRowFindTotalPrice${rowIdx}" style="width:50px"
                                            id="requiredQuantityTextId${rowIdx}" value="` +
                                    details[i].quantityRequired +
                                    `"/></td>
                                    <td><input type="text" class="form-control-sm itemUnitPrice floatNumbersOnly" id="unitPriceTextId${rowIdx}"
                                            value="` +
                                    details[i].unitPrice +
                                    `" style="width:100px"/></td>
                                    <td class="form-control-sm totalPriceColumn" id="TotalPriceTextId${rowIdx}" hidden>` +
                                    details[i].totalPrice +
                                    `</td>
                                    <td class="form-control-sm" id="TotalPriceFormateTextId${rowIdx}" style="text-align:right; color:chocolate">` +
                                    formatedPrice +
                                    `</td>
                                    <td><select class="departmentSelector" name="demartmentDropdown" disabled>
                                        <option value="` +
                                    deptId +
                                    `">` +
                                    deptName +
                                    `</option></select></td>
                                    <td>
                                        <select class="distSelectorFromTable autoSuggestionSelect" id="districtDropdown${rowIdx}" name="districtDropdown" disabled>
                                            <option selected>` +
                                    details[i].districtName +
                                    `</option>
                                        </select></td>
                                    <td>
                                        <select class="particularTableThana" disabled>
                                            <option value="` +
                                    details[i].thanaId +
                                    `" selected>` +
                                    details[i].thanaName +
                                    `</option>
                                        </select></td>
                                    <td>
                                        <select class="areaType" disabled>
                                            <option value="` +
                                    details[i].areaType +
                                    `" selected>` +
                                    details[i].areaType +
                                    `</option></select></td>
                                        <td colspan="2">
                                            <input type="text" class="particularTableRemarks" value="` +
                                    details[i].remarks +
                                    `" disabled /></td>
                                    <td class="text-center">
                                        <button class="btn btn-danger remove" type="button"><i class="fa fa-trash" aria-hidden="true"></i></button></td>
                                </tr>`);

                                getParticularsFromDb(rowIdx);
                                getDepartmentsFrmDb(rowIdx);
                                //getDistrictsFrmDb(rowIdx);
                            }
                        }
                    }
                });
            }

            function loadEstimateApprovers(value) {
                $.ajax({
                    type: "GET",
                    url: "/DraftedBudgeEstimation/GetAllApproverByEstimate?estiId=" + value,
                    data: "{}",
                    success: function(data) {
                        var approvers = data;
                        console.log(approvers);
                        for (var i = 0; i < approvers.length; i++) {
                            if ((Number(approvers[i].approverPriority) < 3) && Number($("#approvalForDropDown").children("option:selected").val()) == 2) {
                                $('#tApproverbody').append(
                                    `<tr id="RowApprover${++rowApproverIdx}">
                                    <td>&nbsp;</td>
                                    <td class="approverName">` +
                                    approvers[i].approverFullName +
                                    `</td>
                                    <td class="approverId" hidden>` +
                                    approvers[i].approverId +
                                    `</td>
                                    <td class="approverPriority" hidden>` +
                                    approvers[i].approverPriority +
                                    `</td>
                                    <td class="approverPriorityType" hidden>` +
                                    approvers[i].approverRoleId +
                                    `</td>
                                    <td class="approverPriorityTypeText">` +
                                    approvers[i].approverRoleName +
                                    `</td>
                                    <td class="approverDepartment">` +
                                    approvers[i].approverDepartment +
                                    `</td>
                                    <td class="approverDepartmentId" hidden>` +
                                    approvers[i].approverDepartmentId +
                                    `</td>
                                    <td class="approverExpectedTime">` +
                                    approvers[i].approverPlanDate.slice(0, 10) +
                                    `</td>
                                    <td class="text-center">
                                       
                                    </td>
                                </tr>`);
                            } else {
                                $('#tApproverbody').append(
                                    `<tr id="RowApprover${++rowApproverIdx}">
                                    <td>&nbsp;</td>
                                    <td class="approverName">` +
                                    approvers[i].approverFullName +
                                    `</td>
                                    <td class="approverId" hidden>` +
                                    approvers[i].approverId +
                                    `</td>
                                    <td class="approverPriority" hidden>` +
                                    approvers[i].approverPriority +
                                    `</td>
                                    <td class="approverPriorityType" hidden>` +
                                    approvers[i].approverRoleId +
                                    `</td>
                                    <td class="approverPriorityTypeText">` +
                                    approvers[i].approverRoleName +
                                    `</td>
                                    <td class="approverDepartment">` +
                                    approvers[i].approverDepartment +
                                    `</td>
                                    <td class="approverDepartmentId" hidden>` +
                                    approvers[i].approverDepartmentId +
                                    `</td>
                                    <td class="approverExpectedTime">` +
                                    approvers[i].approverPlanDate.slice(0, 10) +
                                    `</td>
                                    <td class="text-center">
                                        <button class="btn btn-danger remove" type="button"><i class="fa fa-trash" aria-hidden="true"></i></button>
                                    </td>
                                </tr>`);
                            }


                            if ((lastRecommenderPriority > approvers[i].approverPriority && approvers[i].approverRoleId == 2) && Number(approvers[i].approverId != 20)) {
                                console.log('Approver prority ' + approvers[i].approverPriority);
                                lastRecommenderPriority = approvers[i].approverPriority;
                                console.log('lastRecommenderPriority ' + lastRecommenderPriority);
                            }
                        }
                        console.log(lastRecommenderPriority);
                    }
                });
            }

            function loadSummariesOfThisEstimation(value) {
                var formatter = new Intl.NumberFormat('en-IN',
                    {
                        style: 'currency',
                        currency: 'BDT'

                    });
                $.ajax({
                    type: "GET",
                    url: "/DepartmentWiseSummaryOfBudgetEstimation/LoadDepartmentWiseSummaryDetailsByEstimationId?estimationId=" + value,
                    data: "{}",
                    success: function(data) {
                        var deptSummary = data;
                        let rowDepartmentWiseSummaryTableIndex = 1;
                        for (var i = 0; i < deptSummary.length; i++) {
                            $('#tDepartSummarybody').append(
                                `<tr class="deletedDepartmentRow" id="RowDepartmentSummary${rowDepartmentWiseSummaryTableIndex}">
                                    <td lass="text-left">
                                        <span id="nameDepartmentId${rowDepartmentWiseSummaryTableIndex}"
                                            class="departmentWiserSummaryDepartmentColumn"
                                            style="color:chocolate">` +
                                deptSummary[i].departmentName +
                                `</span>
                                    </td>
                                    <td id="idDepartmentId${rowDepartmentWiseSummaryTableIndex}" class="departmentSummaryDeptId" hidden>` +
                                deptSummary[i].departmentId +
                                `</td>
                                    <td class="text-right">
                                        <span id="totalPriceDepartmentId${rowDepartmentWiseSummaryTableIndex}"
                                            class="departmentWiserSummaryTablePriceColumn" hidden>` +
                                deptSummary[i].price +
                                `</span>
                                        <span style="color:chocolate">` +
                                formatter.format(deptSummary[i].price) +
                                `</span>
                                    </td>
                                </tr>`
                            );
                            rowDepartmentWiseSummaryTableIndex++
                        }
                    }
                });
                $.ajax({
                    type: "GET",
                    url: "/ParticularWiseSummary/GetParticularSummaryDetails?estimationId=" + value,
                    data: "{}",
                    success: function(data) {
                        let partiSummary = data;
                        let rowParticularWiseSummaryTableIndex = 1;
                        for (var i = 0; i < partiSummary.length; i++) {
                            $('#tPartiSummarybody').append(
                                `<tr class="deletedParticularRow" id="RowParticularSummary${rowParticularWiseSummaryTableIndex}">
                                    <td lass="text-left">
                                        <span id="nameParticularId${rowParticularWiseSummaryTableIndex}"
                                            style="color:chocolate">` +
                                partiSummary[i].particularName +
                                `</span>
                                    <td id="idParticularId${rowParticularWiseSummaryTableIndex}" class="particularSummarypartiId" hidden>` +
                                partiSummary[i].particularId +
                                `</td>
                                    </td>
                                    <td class="text-right">
                                        <span id="totalPriceParticularId${rowParticularWiseSummaryTableIndex}" hidden>` +
                                partiSummary[i].price +
                                `</span>
                                        <span style="color:chocolate">` +
                                formatter.format(partiSummary[i].price) +
                                `</span>
                                    </td>
                                </tr>`
                            );
                            rowParticularWiseSummaryTableIndex++;
                        }
                    }
                });
            }


            function autoApproverAddorRemove() {


                let estimateTypeValue = $("#approvalForDropDown").children("option:selected").val();


                //document.getElementById("tApproverbody").innerHTML = "";
                //rowApproverIdx = 0;
                //  $('#finalApproverBtn').show();
                // $('#employeeListforApprover option[value="16"]').prop('disabled', false);//.css('display', 'none');
                //$('#employeeListforApprover option[value="20"]').prop('disabled', false);//.css('display', 'none');

                if (Number(estimateTypeValue) == 2) {

                    // $('#employeeListforApprover option[value="16"]').prop('disabled',false);
                    // $("#employeeListforApprover>optgroup>option[value='16']").removeAttr('disabled');
                    console.log('-----------------------------Estimate type new budget ------ zahid');

                    $(document).ready(function() {
                        $('#employeeListforApprover option[value="16"]').prop('disabled', true);
                        $('#employeeListforApprover option[value="20"]').prop('disabled', true);
                    });


                    //$(document).ready(function () {
                    //    $('#finalRecomendorExpectedDate').datepicker({
                    //        format: 'mm/dd/yyyy',
                    //        "autoclose": true

                    //    }).on("changeDate", function (selected) {

                    //        $('#expectedTimeId1').html($(this).val());
                    //    });

                    //    $('#finalApproverExpectedDate').datepicker({
                    //        format: 'mm/dd/yyyy',
                    //        "autoclose": true
                    //    }).on("changeDate", function (selected) {

                    //        $('#expectedTimeId2').html($(this).val());
                    //    });
                    //});


                    $('#finalApproverBtn').hide();

                    //var totalBudgetPrice = tableOpen == 1 ? parseFloat($("#sumOfTotalPrice").text()) : parseFloat($("#totalPriceText").val());
                    //if (isNaN(totalBudgetPrice)) {
                    //    totalBudgetPrice = 0
                    //}

                    //$('#tApproverbody').append(
                    //    `<tr id="RowApprover${++rowApproverIdx}">
                    //        <td>&nbsp;</td>
                    //        <td id="nameApproverId${rowApproverIdx}" class="approverName"> Md Sayed Nazmul Hasan </td>
                    //        <td id="idApproverId${rowApproverIdx}" class="approverId" hidden> 20 </td>
                    //        <td id="priorityApproverId${rowApproverIdx}" class="approverPriority" hidden>2</td>
                    //        <td id="priorityApproverTypeId${rowApproverIdx}" class="approverPriorityType" hidden>2</td>
                    //        <td id="priorityApproverTypeTextId${rowApproverIdx}" class="approverPriorityTypeText">Recomendor</td>
                    //        <td id="departmentApproverId${rowApproverIdx}" class="approverDepartment">Business Controll</td>
                    //        <td id="departmentIdApproverId${rowApproverIdx}" class="approverDepartmentId" hidden>5</td>
                    //        <td id="expectedTimeId${rowApproverIdx}" class="approverExpectedTime" hidden></td>
                    //        <td id="approverExpectedDate${rowApproverIdx}" class="approverExpectedDate">
                    //            <input readonly="readonly" id="finalRecomendorExpectedDate" class="form-control datepicker"  />
                    //        </td>
                    //        <td class="text-center">

                    //        </td>
                    //    </tr>`
                    //);

                    //$('#tApproverbody').append(
                    //    `<tr id="RowApprover${++rowApproverIdx}">
                    //        <td>&nbsp;</td>
                    //        <td id="nameApproverId${rowApproverIdx}" class="approverName"> Md Arif Al Islam </td>
                    //        <td id="idApproverId${rowApproverIdx}" class="approverId" hidden> 16 </td>
                    //        <td id="priorityApproverId${rowApproverIdx}" class="approverPriority" hidden>1</td>
                    //        <td id="priorityApproverTypeId${rowApproverIdx}" class="approverPriorityType" hidden>1</td>
                    //        <td id="priorityApproverTypeTextId${rowApproverIdx}" class="approverPriorityTypeText">Final Approver</td>
                    //        <td id="departmentApproverId${rowApproverIdx}" class="approverDepartment">MD's Office</td>
                    //        <td id="departmentIdApproverId${rowApproverIdx}" class="approverDepartmentId" hidden>23</td>
                    //        <td id="expectedTimeId${rowApproverIdx}" class="approverExpectedTime" hidden> </td>
                    //         <td id="approverExpectedDate${rowApproverIdx}" class="approverExpectedDate">
                    //            <input readonly="readonly" id="finalApproverExpectedDate" class="form-control datepicker"  />
                    //        </td>
                    //        <td class="text-center">

                    //        </td>
                    //    </tr>`
                    //);


                }


            }


            //upload file limitation
            var uploadField = document.getElementById("estimationfiles");
            uploadField.onchange = function() {
                if (this.files[0].size > 10000000) {
                    alertify.alert("File is too big!");
                    this.value = "";
                };
            };

            // PROCUREMENT APPROVAL show or hide on Estimate type change
            $("#approvalForDropDown").change(function() {
                //alert("Handler for .change() called.");
                let estimateTypeValue = $("#approvalForDropDown").children("option:selected").val()
                let estimateTypeTxt = $("#approvalForDropDown").children("option:selected").text()



                getCurrencyTypeFromDbBasedOnEstimationTypeAndDropdownName("CurrencyType", estimateTypeValue);

                if ((estimateTypeValue == '7' && estimateTypeTxt == "PROCUREMENT APPROVAL") || (estimateTypeValue == '8' && estimateTypeTxt == "Factsheet") )
                    $('.procurementApprovalDiv').show(1000);
                else
                    $('.procurementApprovalDiv').hide();
            });

            $("input[name=attachedFiles]").change(function() {
                var files = $(this).get(0).files;
                for (var x = 0; x < files.length; x++) {
                    filelist.push(files[x]);
                    $("#attachmentsTableNew").append('<li id="liAttach' + x + '"><a href="#">' + files[x].name + '</a><span id="' + x + '" class="removeAttachLocal" style="font-size:15px;">&#10060;</span></li>');
                }
            });

            $("body").on('click',
                ".removeAttachLocal",
                function() {
                    var index = this.id;
                    filelist[index] = {};
                    $(this).parent().remove();
                });

            $("body").on('click',
                ".removeAttachServer",
                function() {
                    var index = this.id;
                    filetoDeleteFromDB.push(parseInt(index));
                    $(this).parent().remove();
                });

            $("#tbody").on('keypress',
                '.onlyNumber',
                function(e) {
                    if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
                        return false;
                    }
                });

            $('#addBtn').on('click',
                function() {
                    $('#tbody').append(
                        `<tr id="R${++rowIdx}">
                        <td>&nbsp;</td>
                        <td>
                            <select class="form-control-sm particularSelectorFromTable autoSuggestionSelect" id="paticularDropdown${rowIdx}" class="particularSelectorFromTable" name="particularSelector"></select>
                        </td>
                        <td>
                            <select class="form-control-sm itemCategoryDropdownSelector autoSuggestionSelect" id="itemCategoryDropdown${rowIdx}" name="itemCategoryDropdown"></select>
                        </td>
                        <td>
                            <select class="form-control-sm itemSelectorFromTable autoSuggestionSelect" id="itemDropdown${rowIdx}" name="itemDropdown"></select>
                        </td>
                        <td>
                            <span id="itemCodeTextId${rowIdx}" class="itemCodeText" style="color:chocolate"></span>
                        </td>
                        <td>
                            <span id="itemUnitTextId${rowIdx}" class="itemUnitText" style="color:chocolate"></span>
                        </td>
                        <td>
                            <input type="text" class="onlyNumber findTotalPrice nomuct numbersOnly singleRowFindTotalPrice${rowIdx}" id="NoOfMaUTCaTextId${rowIdx}" style="width:75px" />
                        </td>
                        <td>
                            <input type="text" class="onlyNumber findTotalPrice nodut numbersOnly singleRowFindTotalPrice${rowIdx}" id="NoOfDTUTextId${rowIdx}" style="width:75px" />
                        </td>
                        <td>
                            <input type="text" class="floatNumbersOnly findTotalPrice rqt numbersOnlyAndGreaterThan0 singleRowFindTotalPrice${rowIdx}" id="requiredQuantityTextId${rowIdx}" value="1" style="width:75px" />
                        </td>
                        <td>
                            <input type="text" class="form-control-sm itemUnitPrice floatNumbersOnly" id="unitPriceTextId${rowIdx}" style="width:100px" />
                        </td>
                        <td class="form-control-sm totalPriceColumn" id="TotalPriceTextId${rowIdx}" hidden>0</td>
                        <td class="form-control-sm" id="TotalPriceFormateTextId${rowIdx}" style="text-align:right; color:chocolate">0</td>                       
                        <td>
                            <select class="departmentSelector" id="departmentDropdown${rowIdx}" name="demartmentDropdown"></select>
                        </td>
                        <td>
                            <select class="distSelectorFromTable autoSuggestionSelect" id="districtDropdown${rowIdx}" name="districtDropdown"></select>
                        </td>
                        <td>
                            <select class="particularTableThana" id="thanaDropdown${rowIdx}" name="thanaDropdown"></select>
                        </td>
                        <td>
                            <select class="form-control-sm areaType" id="areaTypeDropdown">
                                <option>Select</option>
                                <option>Metropolitan</option>
                                <option>Urban</option>
                                <option>Rural</option>
                            </select>
                        </td>
                        <td colspan="2">
                            <input type="text" class="particularTableRemarks">
                        </td>
                        <td class="text-center">
                            <button class="btn btn-danger remove" type="button"><i class="fa fa-trash" aria-hidden="true"></i></button>
                        </td>
                    </tr>`);
                    getParticularsFromDb(rowIdx);
                    getDepartmentsFrmDb(rowIdx);
                    getDistrictsFrmDb(rowIdx);

                    $('.autoSuggestionSelect').css('width', '100%');
                    $(".autoSuggestionSelect").select2({});
                });

            //add row by item code
            $('#addByCode').on('click',
                function() {
                    var itemCode = $("#itemCodeSearch").val();
                    if (itemCode == '' || typeof itemCode === 'undefined')
                        return;

                    $.ajax({
                        type: "GET",
                        url: "/Item/GetItemAnditsDetailByItemCode?code=" + itemCode,
                        data: "{}",
                        success: function(data) {
                            console.log(data);
                            if (data == null) {
                                $("#errorItemCodelabel").text("Invalid Item Code");
                                return;
                            }
                            $("#errorItemCodelabel").text("");
                            $('#tbody').append(`
                        <tr id="R${++rowIdx}">
                            <td>&nbsp;</td>
                            <td>
                                <select class="form-control-sm particularSelectorFromTable particularSelectorFromTable autoSuggestionSelect" id="paticularDropdown${rowIdx}" style="width:100%" name="particularSelector"></select>
                            </td>
                            <td>
                                <select class="form-control-sm itemCategoryDropdownSelector autoSuggestionSelect" id="itemCategoryDropdown${rowIdx}" name="itemCategoryDropdown"></select>
                            </td>
                            <td>
                                <select class="form-control-sm itemSelectorFromTable autoSuggestionSelect" id="itemDropdown${rowIdx}" name="itemDropdown">
                            </td>
                            <td>
                                <span id="itemCodeTextId${rowIdx}" class="itemCodeText" style="color:chocolate"></span>
                            </td>
                            <td>
                                <span id="itemUnitTextId${rowIdx}" class="itemUnitText" style="color:chocolate"></span>
                            </td>
                            <td>
                                <input type="text" class="form-control-sm findTotalPrice nomuct singleRowFindTotalPrice${rowIdx} numbersOnly" id="NoOfMaUTCaTextId${rowIdx}" style="width:75px" />
                            </td>
                            <td>
                                <input type="text" class="form-control-sm findTotalPrice nodut singleRowFindTotalPrice${rowIdx} numbersOnly" id="NoOfDTUTextId${rowIdx}" style="width:75px" />
                            </td>
                            <td>
                                <input type="text" class="form-control-sm findTotalPrice rqt singleRowFindTotalPrice${rowIdx} floatNumbersOnly" id="requiredQuantityTextId${rowIdx}" style="width:75px" value="1"/>
                            </td>
                            <td>
                                <input type="text" class="form-control-sm itemUnitPrice floatNumbersOnly" id="unitPriceTextId${rowIdx}" style="width:100px" />
                            </td>
                            <td class="form-control-sm totalPriceColumn" id="TotalPriceTextId${rowIdx}" hidden> 0</td>
                            <td class="form-control-sm" id="TotalPriceFormateTextId${rowIdx}" style="text-align:right; color:chocolate"> 0</td>
                            <td>
                                <select class="form-control-sm departmentSelector" id="departmentDropdown${rowIdx}" name="demartmentDropdown">
                            </td>
                            <td>
                                <select class="form-control-sm distSelectorFromTable autoSuggestionSelect" id="districtDropdown${rowIdx}" name="districtDropdown">
                            </td>
                            <td>
                                <select class="form-control-sm particularTableThana" id="thanaDropdown${rowIdx}" name="thanaDropdown">
                            </td>
                            <td>
                                <select class="form-control-sm areaType" id="areaTypeDropdown">
                                    <option>Select</option>
                                    <option>Metropolitan</option>
                                    <option>Urban</option>
                                    <option>Rural</option>
                                </select>
                            </td>
                            <td colspan="2">
                                <input type="text" class="particularTableRemarks">
                            </td>
                            <td class="text-center">
                                <button class="btn btn-danger remove" type="button"><i class="fa fa-trash" aria-hidden="true"></i></button>
                            </td>
                        </tr>`);
                            $("#paticularDropdown" + rowIdx).append(`<option value="${data.particularId}">
                                       ${data.particularName}
                                  </option>`);
                            $("#itemCategoryDropdown" + rowIdx).append(`<option value="${data.itemCategoryId}">
                                       ${data.itemCategoryName}
                                  </option>`);
                            $("#itemDropdown" + rowIdx).append(`<option value="${data.itemId}">
                                       ${data.itemName}
                                  </option>`);
                            $("#itemCodeTextId" + rowIdx).html(data.itemCode);
                            $("#itemUnitTextId" + rowIdx).text(data.itemUnitName);
                            $("#unitPriceTextId" + rowIdx).val(data.itemUnitPrice);

                            getDepartmentsFrmDb(rowIdx);
                            getDistrictsFrmDb(rowIdx);

                            $('.autoSuggestionSelect').css('width', '100%');
                            $(".autoSuggestionSelect").select2({});

                            $("#TotalPriceTextId" + rowIdx).text(0);
                            $("#NoOfMaUTCaTextId" + rowIdx).val(0);
                            $("#NoOfDTUTextId" + rowIdx).val(0);
                            $("#requiredQuantityTextId" + rowIdx).val(0);
                            getSumOfTotalPrice();
                        }
                    });
                });

            //event to remove a row from tbody table
            $('#tbody').on('click',
                '.remove',
                function() {
                    $(this).closest('tr').remove();
                    //rowIdx--;
                    getSumOfTotalPrice();
                });

            //when particular selector changes
            $('#tbody').on('change',
                '.particularSelectorFromTable',
                function() {
                    let getDomId = $(this).attr('id');
                    var rowTrackId = getDomId.slice(17);
                    var value = $("#paticularDropdown" + rowTrackId).val();
                    getItemCategoryById(value, rowTrackId);
                    //getItemUnitDetails(0, rowTrackId);
                    $('#itemDropdown' + rowTrackId).text("Select");
                    setDefaultDataOnMultipleSpanAndTextBoxOnParticularTable(rowTrackId);
                });

            //when itemCategoryDropdownSelector
            $('#tbody').on('change',
                '.itemCategoryDropdownSelector',
                function() {
                    let getDomId = $(this).attr('id');
                    var rowTrackId = getDomId.slice(20);
                    var value = $("#itemCategoryDropdown" + rowTrackId).val();
                    getItemUnitDetails(value, rowTrackId);
                    setDefaultDataOnMultipleSpanAndTextBoxOnParticularTable(rowTrackId);
                });

            //when Item Selector changes
            $('#tbody').on('change',
                '.itemSelectorFromTable',
                function() {
                    $("#validationMsgOnParticular").hide();
                    let getDomId = $(this).attr('id');
                    var rowTrackId = getDomId.slice(12);
                    var value = $("#itemDropdown" + rowTrackId).val();
                    var flag;
                    for (var i = 0; i < storeItemDetails.length; i++) {
                        if (storeItemDetails[i]['id'] == value) {
                            flag = i;
                            break;
                        }
                    }
                    setValuesOnItemCodeAndItemUnitTextAndUnitPrice(rowTrackId, flag);
                });

            //department selector change
            $('#tbody').on('change',
                '.departmentSelector',
                function() {
                    $("#validationMsgOnDepartment").hide();
                    getDepartmentSummary();
                });

            //when district changes
            $('#tbody').on('change',
                '.distSelectorFromTable',
                function() {

                    var child = $(this).closest('tr').nextAll();
                    var rowTrackId = child.prevObject.attr("id").slice(1);
                    var value = $("#districtDropdown" + rowTrackId).val();
                    getThanaByDistIdFromDB(value, rowTrackId);
                });

            //when thana changes
            $('#tbody').on('change',
                '.particularTableThana',
                function() {
                    $("#validationMsgOnThana").hide();
                });

            //keyup event on findTotalPrice classes
            $('#tbody').on('keyup',
                '.findTotalPrice',
                function() {
                    var child = $(this).closest('tr').nextAll();
                    var rowTrackId = child.prevObject.attr("id").slice(1);
                    calculateTotalPrice(rowTrackId);
                });
            $('#tbody').on('keyup',
                '.itemUnitPrice',
                function() {
                    var child = $(this).closest('tr').nextAll();
                    var rowTrackId = child.prevObject.attr("id").slice(1);
                    calculateTotalPrice(rowTrackId);
                });

            //employee list selector change
            $("#employeeListforApprover").change(function() {
                var selectorID = $("#employeeListforApprover").val();
                if (selectorID == 16) {
                    var o = new Option("1", 1);
                    $(o).html(1);
                    $("#priorityforApprover").append(o);
                    $("#priorityforApprover").val(1);
                    $("#priorityforApprover").prop("disabled", true);
                } else {
                    $("#priorityforApprover").prop("disabled", false);
                    $("#priorityforApprover option[value='1']").remove();
                }
                for (var x = 0; x < storeUsersWithDepartmentName.length; x++) {
                    if (storeUsersWithDepartmentName[x].userID == selectorID) {
                        $("#userDepartmentID").val(storeUsersWithDepartmentName[x].departmentName);
                        $("#DeptIdUserID").val(storeUsersWithDepartmentName[x].departmentId);
                        break;
                    }
                }
            });

            $("#addApproverForm").change(function() {
                showErrorMessageBelowCtrl('priorityforApprover', 'please add priority', false);
                showErrorMessageBelowCtrl('employeeListforApprover', 'please add employee', false);
                showErrorMessageBelowCtrl('datetimepickerApproverTimeLine', 'please select expected timeline', false);
                showErrorMessageBelowCtrl('priorityforApprover', 'please select MD Sir For Approval', false);

            });

            //add row in approver list
            var rowApproverIdx = 0;
            $('#addApprover').on('click',
                function() {
                    showErrorMessageBelowCtrl('app_err-container', 'please add alteast one approver', false);

                    var selectedsequenORparallleVal = "";
                    var selectedArrproverTyepVal = "";

                    var selectedsequenORparallle = $("#sequenORparalllerRadioDiv input[type='radio']:checked");
                    var selectedArrproverTyep = $("#approverTypeRadioDiv input[type='radio']:checked");
                    if (selectedsequenORparallle.length > 0 && selectedArrproverTyep.length > 0) {
                        var minimumLevel = lastRecommenderPriority;
                        //$("#TableAprroverList tr").each(function (a, b) {
                        //    if (a > 0) {
                        //        var priorityFromtb = $('.approverPriority', b).text();
                        //        if (priorityFromtb != 1) {
                        //            if (priorityFromtb <= minimumLevel)
                        //                minimumLevel = priorityFromtb
                        //        }
                        //    }
                        //});

                        selectedsequenORparallleVal = selectedsequenORparallle.val();
                        selectedArrproverTyepVal = selectedArrproverTyep.val();

                        if (selectedsequenORparallleVal == "Sequencial" && selectedArrproverTyepVal == "2") {
                            minimumLevel--;
                            addApproverinApproverList(minimumLevel, selectedArrproverTyepVal, "Recommender");
                        } else if (selectedsequenORparallleVal == "Parallel" && selectedArrproverTyepVal == "2") {
                            addApproverinApproverList(minimumLevel, selectedArrproverTyepVal, "Recommender");
                        } else if (selectedArrproverTyepVal == "1") {
                            addApproverinApproverList(1, selectedArrproverTyepVal, "Final Approver");
                        } else if (selectedArrproverTyepVal == "3") {
                            addApproverinApproverList(400, selectedArrproverTyepVal, "Informed");
                        }
                    }

                });

            function addApproverinApproverList(priorityParameter, priorityType, priorityTypeTxt) {
                let checkFlag = false;

                var priority = priorityParameter; //$('#priorityforApprover').find(":selected").text();
                var username = $('#employeeListforApprover').find(":selected").text();
                var fields = username.split('/');
                var name = fields[0];

                var userId = $('#employeeListforApprover').find(":selected").val();
                var userDepartment = $('#userDepartmentID').val();
                var DeptIdUserID = $('#DeptIdUserID').val();
                var expectedDate = $('#datetimepickerApproverTimeLine').val();

                var priorityValue = $('#priorityforApprover').find(":selected").val();
                var usernameValue = $('#employeeListforApprover').find(":selected").val();


                if (priorityValue <= 0) {
                    showErrorMessageBelowCtrl('priorityforApprover', 'please add priority', true);
                    return;
                } else {
                    showErrorMessageBelowCtrl('priorityforApprover', 'please select priority', false);
                }
                if (usernameValue <= 0) {
                    showErrorMessageBelowCtrl('employeeListforApprover', 'please add employee', true);
                    return;
                } else {
                    showErrorMessageBelowCtrl('employeeListforApprover', 'please select employee', false);
                }
                if (expectedDate.length <= 0) {
                    showErrorMessageBelowCtrl('datetimepickerApproverTimeLine', 'please select expected timeline', true);
                    return;
                } else {
                    showErrorMessageBelowCtrl('datetimepickerApproverTimeLine', 'please select expected timeline', false);
                }
                $("#TableAprroverList tr").each(function(a, b) {
                    if (a > 0) {
                        var userIdFromtb = $('.approverId', b).text();
                        var priorityFromtb = $('.approverPriority', b).text();
                        if (priorityFromtb == 1 && priority == 1) {
                            showErrorMessageBelowCtrl('employeeListforApprover', 'Already added the approved.', true);
                            checkFlag = true;
                        }

                        if (userIdFromtb == userId && priority == priorityFromtb) {
                            checkFlag = true;
                            console.log("Already Added");
                            showErrorMessageBelowCtrl('priorityforApprover', 'Already added this approved with same priority', true);
                        }
                    }
                });
                if (checkFlag == false) {
                    $('#tApproverbody').append(
                        `<tr id="RowApprover${++rowApproverIdx}">
                            <td>&nbsp;</td>
                            <td id="nameApproverId${rowApproverIdx}" class="approverName">` +
                        name +
                        `</td>
                            <td id="idApproverId${rowApproverIdx}" class="approverId" hidden>` +
                        userId +
                        `</td>
                            <td id="priorityApproverId${rowApproverIdx}" class="approverPriority" hidden>` +
                        priority +
                        `</td>
                            <td id="priorityApproverTypeId${rowApproverIdx}" class="approverPriorityType" hidden>` +
                        priorityType +
                        `</td>
                            <td id="priorityApproverTypeTextId${rowApproverIdx}" class="approverPriorityTypeText">` +
                        priorityTypeTxt +
                        `</td>
                            <td id="departmentApproverId${rowApproverIdx}" class="approverDepartment">` +
                        userDepartment +
                        `</td>
                            <td id="departmentIdApproverId${rowApproverIdx}" class="approverDepartmentId" hidden>` +
                        DeptIdUserID +
                        `</td>
                            <td id="expectedTimeId${rowApproverIdx}" class="approverExpectedTime">` +
                        expectedDate +
                        `</td>
                            <td class="text-center">
                                <button class="btn btn-danger remove" type="button"><i class="fa fa-trash" aria-hidden="true"></i></button>
                            </td>
                        </tr>`
                    );
                }
            }

            //remove row in approver list
            $('#tApproverbody').on('click',
                '.remove',
                function() {

                    var child = $(this).closest('tr').nextAll();
                    child.each(function() {
                        var id = $(this).attr('id');
                        var idx = $(this).children('.row-index').children('p');
                        var dig = parseInt(id.substring(1));
                        idx.html(`Row ${dig - 1}`);
                        $(this).attr('id', `RowApprover${dig - 1}`);
                    });
                    $(this).closest('tr').remove();
                    rowApproverIdx--;
                });

            function validationCheck() {

                var response = true;
                var estimateType = $("#approvalForDropDown").children("option:selected").val();
                var subject = $("#subjectTextId").val();
                var objective = $("#objectiveTextId").val();
                var details = $("#textEditorEstimation").val();
                var planStartDate = $("#datetimepickerEstimationStartDate").val();
                var planEndDate = $("#datetimepickerEstimationEndDate").val();

                showErrorMessageBelowCtrl('approvalForDropDown', 'please select approval for option', false);
                showErrorMessageBelowCtrl('subjectTextId', 'please add subject', false);
                showErrorMessageBelowCtrl('datetimepickerEstimationStartDate', 'please select start date', false);
                showErrorMessageBelowCtrl('datetimepickerEstimationEndDate', 'please select end date', false);
               showErrorMessageBelowCtrl('currencyTypeDropDown', 'please select currency type for total price', false);
                
                var currencyType = $('#currencyTypeDropDown').val();
                
                 if (currencyType <= 0) {
                        showErrorMessageBelowCtrl('currencyTypeDropDown', 'please select currency type for total price', true);
                        response = false;
                        $('html, body').animate({
                            scrollTop: $("#currencyTypeDropDown").offset().top
                        },
                            800);
                    } else {
                        showErrorMessageBelowCtrl('currencyTypeDropDown', 'please select currency type for total price', false);
                    }

                if (estimateType.length <= 0) {
                    showErrorMessageBelowCtrl('approvalForDropDown', 'please select approval for option', true);
                    response = false;
                    $('html, body').animate({
                            scrollTop: $("#approvalForDropDown").offset().top
                        },
                        800);
                } else {
                    showErrorMessageBelowCtrl('approvalForDropDown', 'please select approval for option', false);
                }

                if (subject.length <= 0) {
                    showErrorMessageBelowCtrl('subjectTextId', 'please add subject', true);
                    response = false;
                    $('html, body').animate({
                            scrollTop: $("#subjectTextId").offset().top
                        },
                        800);
                } else {
                    showErrorMessageBelowCtrl('subjectTextId', 'please add subject', false);
                }

                if (planStartDate.length <= 0) {
                    showErrorMessageBelowCtrl('datetimepickerEstimationStartDate', 'please select start date', true);
                    response = false;
                    $('html, body').animate({
                            scrollTop: $("#datetimepickerEstimationStartDate").offset().top
                        },
                        800);
                } else {
                    showErrorMessageBelowCtrl('datetimepickerEstimationStartDate', 'please select start date', false);
                }

                if (planEndDate.length <= 0) {
                    showErrorMessageBelowCtrl('datetimepickerEstimationEndDate', 'please select end date', true);
                    response = false;
                    $('html, body').animate({
                            scrollTop: $("#datetimepickerEstimationEndDate").offset().top
                        },
                        800);
                } else {
                    showErrorMessageBelowCtrl('datetimepickerEstimationEndDate', 'please select end date', false);
                }

                let strDate = new Date($("#datetimepickerEstimationStartDate").val());
                let endDate = new Date($("#datetimepickerEstimationEndDate").val());
                if (strDate > endDate) {
                    showErrorMessageBelowCtrl('datetimepickerEstimationEndDate', 'End Date should be set after Start Date.', true);
                    response = false;
                    $('html, body').animate({
                            scrollTop: $("#datetimepickerEstimationEndDate").offset().top
                        },
                        800);
                } else {
                    showErrorMessageBelowCtrl('datetimepickerEstimationEndDate', 'please select end date', false);
                }

                var tableApproverRowCount = $('#TableAprroverList tr').length;
                if (tableApproverRowCount <= 1) {
                    showErrorMessageBelowCtrl('app_err-container', 'please add alteast one approver', true);
                    response = false;
                    $('html, body').animate({
                            scrollTop: $("#app_err-container").offset().top
                        },
                        800);
                } else
                    showErrorMessageBelowCtrl('app_err-container', 'please add alteast one approver', false);

                let checkFlagMD = false;
                var approverDeptList = [];
                $("#TableAprroverList tr").each(function(a, b) {
                    var priorityFromtb = $('.approverPriority', b).text()
                    approverDeptList.push($('.approverDepartmentId', b).text());
                    if (priorityFromtb == 1) {
                        checkFlagMD = true;
                    }
                });

                //if (tableOpen == 1) {
                //    let itemDeptList = [];
                //    $('.particularItemsAndDetailsTable tr').each(function (a, b) {
                //        var deptId = $('.departmentSelector', b).find(":selected").val();
                //        if (deptId == "-1" || typeof deptId === 'undefined') {
                //            console.log("not added");
                //        }
                //        else {
                //            itemDeptList.push($('.departmentSelector', b).find(":selected").val());
                //        }
                //    });
                //    console.log(itemDeptList);
                //    console.log(approverDeptList);

                //    var checkFlagDept = true;
                //    for (let i = 0; i < itemDeptList.length; i++) {
                //        if (approverDeptList.indexOf(itemDeptList[i]) !== -1) {
                //            continue;
                //        }
                //        else {
                //            checkFlagDept = false;
                //            break;
                //        }
                //    }
                //    if (checkFlagDept == false) {
                //        console.log("You have added a item but not added that item's responsible department in Approver list .Please select Approver");
                //        //showErrorMessageBelowCtrl('employeeListforApprover', "You have added a item but not added that item's responsible department in Approver list .Please select Approver", true);
                //        $("#validationMsgOnDepartment").show();
                //        response = false;
                //        $("#validationMsgOnDepartment").text("You have added a item but not added that item's responsible department in Approver list .Please select Approver");
                //        validFlag = -1;
                //        $('html, body').animate({
                //            scrollTop: $("#validationMsgOnDepartment").offset().top
                //        }, 800);
                //    }
                //    else {
                //        $("#validationMsgOnDepartment").hide();
                //        //showErrorMessageBelowCtrl('employeeListforApprover', "You have added a item but not added that item's responsible department in Approver list .Please select Approver", false);
                //        console.log("Approver correct");
                //    }
                //}

                if (checkFlagMD == false) {
                    showErrorMessageBelowCtrl('employeeListforApprover', 'please select Approver For this Approval', true);
                    response = false;
                    $('html, body').animate({
                            scrollTop: $("#employeeListforApprover").offset().top
                        },
                        800);
                } else {
                    showErrorMessageBelowCtrl('employeeListforApprover', 'please select Approver For this Approval', false);
                }

                let estimateTypeValue = $("#approvalForDropDown").children("option:selected").val()
                let estimateTypeTxt = $("#approvalForDropDown").children("option:selected").text()

                // procurement approval validation
                if ((estimateTypeValue == '7' && estimateTypeTxt == "PROCUREMENT APPROVAL") || (estimateTypeValue == '8' && estimateTypeTxt == "Factsheet") ) {
                    var pAReferenceNo = $("#paReferenceNumberTextId").val();
                    var titleOfPRorRFQ = $("#titleOfPRorRFQTextId").val();
                    var rFQReferenceNo = $("#RFQReferNoTextId").val();
                    var pRReferenceNo = $("#PRReferenceNoTextId").val();
                    var nameOfRequester = $("#nameAndCellRequesterTextId").val();
                    var departmentId = $("#deptOrDivTextId").val();
                    var rFQProcess = $("#RFQProcessTextId").val();
                    var sourcingMethod = $("#sourcingMethodTextId").val();
                    var nameOfRecommendedSupplier = $("#nameSupplierTextId").val();
                    var purchaseValue = $("#purchaseValueTextId").val();
                    var savingAmount = $("#savingAmountTextId").val();
                    var savingType = $("#savingTypeDropDown").val();

                    showErrorMessageBelowCtrl('paReferenceNumberTextId', 'please add PA Reference', false);
                    showErrorMessageBelowCtrl('titleOfPRorRFQTextId', 'please add Title of PR or RFQ', false);
                    showErrorMessageBelowCtrl('RFQReferNoTextId', 'please add RFQ Reference Number', false);
                    showErrorMessageBelowCtrl('PRReferenceNoTextId', 'please add PR Reference Number', false);
                    showErrorMessageBelowCtrl('nameAndCellRequesterTextId', 'please add Name of the Requester', false);
                    showErrorMessageBelowCtrl('deptOrDivTextId', 'please add Department', false);
                    showErrorMessageBelowCtrl('RFQProcessTextId', 'please add RFQ Process', false);
                    showErrorMessageBelowCtrl('sourcingMethodTextId', 'please add Sourcing method', false);
                    showErrorMessageBelowCtrl('nameSupplierTextId', 'please add name of the Supplier', false);
                    showErrorMessageBelowCtrl('purchaseValueTextId', 'please add Purchase value', false);
                    showErrorMessageBelowCtrl('savingAmountTextId', 'please add saving amount', false);
                    showErrorMessageBelowCtrl('savingTypeDropDown', 'please add saving type', false);

                    if (pAReferenceNo.length <= 0) {
                        showErrorMessageBelowCtrl('paReferenceNumberTextId', 'please add PA Reference', true);
                        response = false;
                        $('html, body').animate({
                                scrollTop: $("#paReferenceNumberTextId").offset().top
                            },
                            800);
                    } else {
                        showErrorMessageBelowCtrl('paReferenceNumberTextId', 'please add PA Reference', false);
                    }

                    if (titleOfPRorRFQ.length <= 0) {
                        showErrorMessageBelowCtrl('titleOfPRorRFQTextId', 'please add Title of PR or RFQ', true);
                        response = false;
                        $('html, body').animate({
                                scrollTop: $("#titleOfPRorRFQTextId").offset().top
                            },
                            800);
                    } else {
                        showErrorMessageBelowCtrl('titleOfPRorRFQTextId', 'please add Title of PR or RFQ', false);
                    }

                    if (rFQReferenceNo.length <= 0) {
                        showErrorMessageBelowCtrl('RFQReferNoTextId', 'please add RFQ Reference Number', true);
                        response = false;
                        $('html, body').animate({
                                scrollTop: $("#RFQReferNoTextId").offset().top
                            },
                            800);
                    } else {
                        showErrorMessageBelowCtrl('RFQReferNoTextId', 'please add RFQ Reference Number', false);
                    }

                    if (pRReferenceNo.length <= 0) {
                        showErrorMessageBelowCtrl('PRReferenceNoTextId', 'please add PR Reference Number', true);
                        response = false;
                        $('html, body').animate({
                                scrollTop: $("#PRReferenceNoTextId").offset().top
                            },
                            800);
                    } else {
                        showErrorMessageBelowCtrl('PRReferenceNoTextId', 'please add PR Reference Number', false);
                    }

                    if (nameOfRequester.length <= 0) {
                        showErrorMessageBelowCtrl('nameAndCellRequesterTextId', 'please add Name of the Requester', true);
                        response = false;
                        $('html, body').animate({
                                scrollTop: $("#nameAndCellRequesterTextId").offset().top
                            },
                            800);
                    } else {
                        showErrorMessageBelowCtrl('nameAndCellRequesterTextId', 'please add Name of the Requester', false);
                    }

                    if (departmentId <= 0) {
                        showErrorMessageBelowCtrl('deptOrDivTextId', 'please add Department', true);
                        response = false;
                        $('html, body').animate({
                                scrollTop: $("#deptOrDivTextId").offset().top
                            },
                            800);
                    } else {
                        showErrorMessageBelowCtrl('deptOrDivTextId', 'please add Department', false);
                    }
                    // commented based on SCM new requirments
                    //if (rFQProcess.length <= 0) {
                    //    showErrorMessageBelowCtrl('RFQProcessTextId', 'please add RFQ Process', true);
                    //    response = false;
                    //    $('html, body').animate({
                    //            scrollTop: $("#RFQProcessTextId").offset().top
                    //        },
                    //        800);
                    //} else {
                    //    showErrorMessageBelowCtrl('RFQProcessTextId', 'please add RFQ Process', false);
                    //}

                    //if (sourcingMethod.length <= 0) {
                    //    showErrorMessageBelowCtrl('sourcingMethodTextId', 'please add Sourcing method', true);
                    //    response = false;
                    //    $('html, body').animate({
                    //            scrollTop: $("#sourcingMethodTextId").offset().top
                    //        },
                    //        800);
                    //} else {
                    //    showErrorMessageBelowCtrl('sourcingMethodTextId', 'please add Sourcing method', false);
                    //}

                    if (nameOfRecommendedSupplier.length <= 0) {
                        showErrorMessageBelowCtrl('nameSupplierTextId', 'please add name of the Supplier', true);
                        response = false;
                        $('html, body').animate({
                                scrollTop: $("#nameSupplierTextId").offset().top
                            },
                            800);
                    } else {
                        showErrorMessageBelowCtrl('nameSupplierTextId', 'please add name of the Supplier', false);
                    }

                    if (purchaseValue.length <= 0) {
                        showErrorMessageBelowCtrl('purchaseValueTextId', 'please add Purchase value', true);
                        response = false;
                        $('html, body').animate({
                                scrollTop: $("#purchaseValueTextId").offset().top
                            },
                            800);
                    } else {
                        showErrorMessageBelowCtrl('purchaseValueTextId', 'please add Purchase value', false);
                    }

                    if (savingAmount.length <= 0) {
                        showErrorMessageBelowCtrl('savingAmountTextId', 'please add saving amount', true);
                        response = false;
                        $('html, body').animate({
                                scrollTop: $("#savingAmountTextId").offset().top
                            },
                            800);
                    } else {
                        showErrorMessageBelowCtrl('savingAmountTextId', 'please add saving amount', false);
                    }

                    if (savingType.length <= 0) {
                        showErrorMessageBelowCtrl('savingTypeDropDown', 'please add saving type', true);
                        response = false;
                        $('html, body').animate({
                                scrollTop: $("#savingTypeDropDown").offset().top
                            },
                            800);
                    } else {
                        showErrorMessageBelowCtrl('savingTypeDropDown', 'please add saving type', false);
                    }
                }

                return response;
            }

            function ConstructEstimationObjectFromHTML() {

                showErrorMessageBelowCtrl('employeeListforApprover', 'please select Approver For this Approval', false);
                var result = validationCheck();
                console.log(result);
                if (result == false) {
                    return;
                }

                var validFlag = 1
                var estimation = {};
                var procurementApprovalRequest = {};
                var estimateDetailsList = [];
                var estimateApproverList = [];
                var departmentWiseSummaryList = [];
                var particularWiseSummaryList = [];

                if (tableOpen == 1) {
                    $('.particularItemsAndDetailsTable tr').each(function(a, b) {
                        var itemId = $('.itemSelectorFromTable', b).find(":selected").val()
                        var deptId = $('.departmentSelector', b).find(":selected").val();
                        var thanaId = $('.particularTableThana', b).find(":selected").val();
                        console.log(itemId);
                        console.log(deptId);

                        if (itemId == null) {
                            console.log("pass");
                        } else {
                            if (itemId == "-1" || typeof itemId === 'undefined') {
                                console.log("Item is not selected on " + a + " row in Particular Item Table.");
                                $("#validationMsgOnParticular").show();
                                $("#validationMsgOnParticular").text("Item is not selected on row :" + a);
                                validFlag = -1;
                                $('html, body').animate({
                                        scrollTop: $("#validationMsgOnParticular").offset().top
                                    },
                                    800);
                            } else {
                                if (deptId == "-1" || typeof deptId === 'undefined') {
                                    console.log("Department is not selected on " + a + " row in Particular Item Table.");
                                    $("#validationMsgOnDepartment").show();
                                    $("#validationMsgOnDepartment").text("Select Department on row :" + a);
                                    validFlag = -1;
                                    $('html, body').animate({
                                            scrollTop: $("#validationMsgOnDepartment").offset().top
                                        },
                                        800);
                                } else {
                                    if (thanaId == "-1" || typeof thanaId === 'undefined') {
                                        console.log("Thana is not selected on " + a + " row in Particular Item Table.");
                                        $("#validationMsgOnThana").show();
                                        $("#validationMsgOnThana").text("Select Thana on row :" + a);
                                        validFlag = -1;
                                        $('html, body').animate({
                                                scrollTop: $("#validationMsgOnThana").offset().top
                                            },
                                            800);
                                    } else {
                                        estimateDetailsList.push({
                                            particular: $('.particularSelectorFromTable', b).find(":selected").text(),
                                            itemCategory: $('.itemCategoryDropdownSelector', b).find(":selected").text(),
                                            itemName: $('.itemSelectorFromTable', b).find(":selected").text(),
                                            item_Id: $('.itemSelectorFromTable', b).val(),
                                            itemCode: $('.itemCodeText', b).text(),
                                            itemUnit: $('.itemUnitText', b).text(),
                                            noOfMachineAndUsagesAndTeamAndCar: $('.nomuct', b).val(),
                                            noOfDayAndTotalUnit: $('.nodut', b).val(),
                                            quantityRequired: $('.rqt', b).val(),
                                            unitPrice: $('.itemUnitPrice', b).val(),
                                            totalPrice: $('.totalPriceColumn', b).text(),
                                            responsibleDepartmentName: $('.departmentSelector', b).find(":selected").text(),
                                            responsibleDepartment_Id: $('.departmentSelector', b).find(":selected").val(),
                                            districtName: $('.distSelectorFromTable', b).find(":selected").text(),
                                            thanaName: $('.particularTableThana', b).find(":selected").text(),
                                            thana_Id: $('.particularTableThana', b).find(":selected").val(),
                                            areaType: $('.areaType', b).find(":selected").val(),
                                            remarks: $('.particularTableRemarks', b).val()
                                        });

                                    }
                                }
                            }
                        }
                    });

                    var departmentSummaryTableRows = $('#TableDepartmentWishSummary tr').length;
                    $('#TableDepartmentWishSummary tr').each(function(a, b) {
                        if (a > 0 && a < departmentSummaryTableRows) {
                            if ($('#idDepartmentId' + a).text() == "-1") {
                                console.log("skip");
                            } else {
                                departmentWiseSummaryList.push({
                                    department_Id: parseInt($('#idDepartmentId' + a).text()),
                                    departmentName: $('#nameDepartmentId' + a).text(),
                                    totalPrice: $('#totalPriceDepartmentId' + a).text()
                                });
                            }

                        }
                    });
                    var particularSummaryTableRows = $('#TableParticularWishSummary tr').length;
                    $('#TableParticularWishSummary tr').each(function(a, b) {
                        if (a > 0 && a < particularSummaryTableRows) {
                            if ($('#idParticularId' + a).text() == "-1") {
                                console.log("skip");
                            } else {
                                particularWiseSummaryList.push({
                                    particular_Id: parseInt($('#idParticularId' + a).text()),
                                    particlarName: $('#nameParticularId' + a).text(),
                                    totalPrice: $('#totalPriceParticularId' + a).text()
                                });
                            }
                        }
                    });
                } else {
                    let price = $("#totalPriceText").val();
                    if (price.length <= 0) {
                        showErrorMessageBelowCtrl('totalPriceText', 'please add Total Price', true);
                        response = false;
                        $('html, body').animate({
                                scrollTop: $("#totalPriceText").offset().top
                            },
                            800);
                        return;
                    }
                }

                var tvalue = tableOpen == 1 ? parseFloat($("#sumOfTotalPrice").text()) : parseFloat($("#totalPriceText").val());
                if (isNaN(tvalue)) {
                    tvalue = 0
                }

                estimation = {
                    id: estimationId,
                    estimateType: $("#approvalForDropDown").children("option:selected").val(),
                    currencyType: $("#currencyTypeDropDown").children("option:selected").val(),
                    subject: $("#subjectTextId").val(),
                    objective: $("#objectiveTextId").val(),
                    details: $("#textEditorEstimation").val(),
                    planStartDate: $("#datetimepickerEstimationStartDate").val(),
                    planEndDate: $("#datetimepickerEstimationEndDate").val(),
                    totalPrice: tvalue,
                    totalPriceRemarks : $("#total_price_remarks").val(),
                    currencyTypeText: $("#currencyTypeDropDown").children("option:selected").text()
                };

                //Procurement Approval
                let estimateTypeValue = $("#approvalForDropDown").children("option:selected").val()
                let estimateTypeTxt = $("#approvalForDropDown").children("option:selected").text()

                if ((estimateTypeValue == '7' && estimateTypeTxt == "PROCUREMENT APPROVAL") || (estimateTypeValue == '8' && estimateTypeTxt == "Factsheet") ) {
                    procurementApprovalRequest = {
                        pAReferenceNo: $("#paReferenceNumberTextId").val(),
                        titleOfPRorRFQ: $("#titleOfPRorRFQTextId").val(),
                        rFQReferenceNo: $("#RFQReferNoTextId").val(),
                        pRReferenceNo: $("#PRReferenceNoTextId").val(),
                        nameOfRequester: $("#nameAndCellRequesterTextId").val(),
                        departmentId: $("#deptOrDivTextId").children("option:selected").val(),
                        departmentName: $("#deptOrDivTextId").children("option:selected").text(),
                        rFQProcess: $("#RFQProcessTextId").val(),
                        sourcingMethod: $("#sourcingMethodTextId").val(),
                        nameOfRecommendedSupplier: $("#nameSupplierTextId").val(),
                        purchaseValue: $("#purchaseValueTextId").val(),
                        savingAmount: $("#savingAmountTextId").val(),
                        savingType: $("#savingTypeDropDown").val()
                    };
                }

                $("#TableAprroverList tr").each(function(a, b) {
                    if (a > 0) {
                        estimateApproverList.push({
                            user_Id: $('.approverId', b).text(),
                            approverFullName: $('.approverName', b).text(),
                            status: "2",
                            priority: $('.approverPriority', b).text(),
                            rolePriority_Id: $('.approverPriorityType', b).text(),
                            approverRole: $('.approverPriorityTypeText', b).text(),
                            approverDepartment: $('.approverDepartment', b).text(),
                            expectedTime: $('.approverExpectedTime', b).text()
                        });
                    }
                });

                if (validFlag == 1) {
                    var data = new Response(estimation, estimateApproverList, estimateDetailsList, departmentWiseSummaryList, particularWiseSummaryList, procurementApprovalRequest);
                    return data;
                } else
                    return false;
            }

            //submit preview 
            $("#submitBudgeEstimation").click(function() {
                showErrorMessageBelowCtrl('employeeListforApprover', 'please select Approver For this Approval', false);
                var result = validationCheck();
                console.log(result);
                if (result == false) {
                    return;
                }

                var dataFromHTML = ConstructEstimationObjectFromHTML();
                if (dataFromHTML == false)
                    return;

                ConstructPreviewModal(dataFromHTML);
                return;
            });

            //constract PREVIEW MODAL
            function ConstructPreviewModal(data) {
                var buildItemTable = "";
                var buildDeptSummaryTable = "";
                var buildPartiSummaryTable = "";
                var buildApproverTable = "";

                for (var i = 0; i < data.estimateDetails.length; i++) {
                    var singleItem = `
                    <tr>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].particular +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].itemCategory +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].itemName +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].itemCode +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].itemUnit +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].noOfMachineAndUsagesAndTeamAndCar +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].noOfDayAndTotalUnit +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].quantityRequired +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].unitPrice +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].totalPrice +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].responsibleDepartmentName +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].districtName +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].thanaName +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].areaType +
                        `</td>
                        <td style='padding:5px; width:10%; background-color:#ededed;font-family:Calibri; font-size:small;' align='left' valign='top'>` +
                        data.estimateDetails[i].remarks +
                        `</td>
                    </tr>
                    `;

                    buildItemTable = buildItemTable + singleItem;
                }

                for (var i = 0; i < data.departmentWiseSummary.length; i++) {
                    var singleDeptSummary = `<tr align='center'><td>` + data.departmentWiseSummary[i].departmentName + `</td><td>` + data.departmentWiseSummary[i].totalPrice + `</td></tr>`;

                    buildDeptSummaryTable = buildDeptSummaryTable + singleDeptSummary;
                }

                for (var i = 0; i < data.particularWiseSummary.length; i++) {
                    var singlePartiSummary = `<tr align='center'><td>` + data.particularWiseSummary[i].particlarName + `</td><td>` + data.particularWiseSummary[i].totalPrice + `</td></tr>`;

                    buildPartiSummaryTable = buildPartiSummaryTable + singlePartiSummary;
                }

                for (var i = 0; i < data.estimateApproverList.length; i++) {
                    var singleApproverLine = `<tr align='center'><td>` + data.estimateApproverList[i].approverFullName + `</td><td>` + data.estimateApproverList[i].approverRole + `</td><td>` + data.estimateApproverList[i].approverDepartment + `</td><td>` + data.estimateApproverList[i].expectedTime + `</td></tr>`;

                    buildApproverTable = buildApproverTable + singleApproverLine;
                }

                var itemsAndtheirSummaries = "";
                if (data.estimateDetails.length > 0) {
                    itemsAndtheirSummaries = `<tr>
                                    <td style='width:100%;padding:5px'>
                                        <table align='center' border='0' cellspacing='0' cellpadding='0' style='width:100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='background-color:rgba(0,0,0,0);'><br><br></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td style='padding:5px; background-color:#ededed; width:100%;font-family:Calibri; font-size:100%;' align='center'>
                                        <b>Particular Items and Details</b>
                                        <hr>
                                    </td>
                                </tr>
                                <tr>
                                    <td style='padding-bottom:30px 0px 0px 0px; width: 100%; background-color:#ededed;'>
                                        <!--Estimation's Item Details Table-->
                                        <table align='left' border='0' cellspacing='0' cellpadding='0' style='width:100%;'>
                                            <!--HEADER-->
                                            <thead>
                                                <tr>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Particular</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Item Category</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Item</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Item Code</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:5%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Unit</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b>Machine /Usages <br />/Team <br />/Car<br /><u>Number</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>No. Of Day /Total Unit</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Required Quantity</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Unit Price</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Total Price (TK.)</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Responsible Department</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>District</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Thana</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:10%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Area Type</u></b>
                                                    </td>
                                                    <td style='padding:5px; width:20%; background-color:#e1e6de;font-family:Calibri; font-size:small;' align='left' valign='bottom'>
                                                        <b><u>Remarks</u></b>
                                                    </td>
                                                </tr>
                                                ` +
                        buildItemTable +
                        `
                                            </thead>
                                            <tbody>
                                                
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <td align='right' colspan='9' style='padding: 0 10px 0 0;'>Grand Total in BDT. </td>
                                                    <td colspan='6'><strong>` +
                        data.estimation.totalPrice +
                        `</strong></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td style='width:100%;padding:5px'>
                                        <table align='center' border='0' cellspacing='0' cellpadding='0' style='width:100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='background-color:rgba(0,0,0,0);'><br><br></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td style='padding:5px; background-color:#e1e6de; width:100%;font-family:Calibri; font-size:100%;' align='center'>
                                        <b>Budget Summary</b>
                                    </td>
                                </tr>
                                <tr>
                                    <!--Summary Tables-->
                                    <td style='padding-bottom:30px 0px 0px 0px; width: 100%; background-color:#ededed;'>
                                        <table align='center' border='0' cellspacing='0' cellpadding='0' style='width:100%'>
                                            <tr>
                                                <td style='width:40%;'>
                                                    <table align='center' border='0' cellspacing='0' cellpadding='0' style='width:100%'>
                                                        <tr>
                                                            <td style='background-color:#d4dcd0;' align='center' colspan='2'>
                                                                <b>Department Wise Summary</b>
                                                                <hr>
                                                            </td>
                                                        </tr>
                                                        <tr align='center'>
                                                            <td><b><u>Department</u></b></td>
                                                            <td><b><u>Total Price(TK.)</u></b></td>
                                                        </tr>
                                                        ` +
                        buildDeptSummaryTable +
                        `
                                                    </table>
                                                </td>
                                                <td style='width=20%;'>
                                                </td>
                                                <td style='width=40%;'>
                                                    <table align='center' border='0' cellspacing='0' cellpadding='0' style='width:100%'>
                                                        <tr>
                                                            <td style='background-color:#d4dcd0;' align='center' colspan='2'>
                                                                <b>Particular Wise Summary</b>
                                                                <hr>
                                                            </td>
                                                        </tr>
                                                        <tr align='center'>
                                                            <td><b><u>Particular</u></b></td>
                                                            <td><b><u>Total Price(TK.)</u></b></td>
                                                        </tr>
                                                        ` +
                        buildPartiSummaryTable +
                        `
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>`;
                }

                $("#previewBody").empty();

                 $('#previewBody').append(`<table id='email-content' class='table' >
                                                    <tbody style='text-align: justify'>
                                                        <tr>
                                                            <div class="card secondary mb-4 procurementApprovalDiv">
                                                            <div class="card-header hideShow">A <b>New Budget Estimate</b> is about to be initiated by you for approval</div>
                                                            <div class="card-body">
                                                                <div class="container-fluid">
                                                                    <div class="form-group  row">
                                                                        <label for="nameSupplierTextId" class="col-sm-2 col-form-label-sm control-label">Approval For :</label>
                                                                        <div class="col-sm-10">
                                                                            <input type="text" class="form-control" value="`+  $("#approvalForDropDown").children("option:selected").text() +`" id="nameSupplierTextId" disabled />
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group row">
                                                                        <label for="purchaseValueTextId" class="col-sm-2 col-form-label-sm">Subject :</label>
                                                                        <div class="col-sm-10">
                                                                            <textarea class="form-control" id="purchaseValueTextId" style="height:100px;" aria-label="With textarea" disabled> `+ data.estimation.subject +`</textarea>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group row">
                                                                        <label for="savingAmountTextId" class="col-sm-2 col-form-label-sm">Objective : </label>
                                                                        <div class="col-sm-10">
                                                                            <textarea class="form-control" id="savingAmountTextId" style="height:100px;" aria-label="With textarea"disabled>` + data.estimation.objective +`</textarea>
                                                                        </div>
                                                                    </div>
                                                                   
                                                                </div>
                                                            </div>
                                                        </div>
                                                        </tr>
                                                        
                                                       
                                                    </tbody>
                                                </table>
                                                <table class='table'>
                                                    <tbody>
                                                        <tr>
                                                                        `+
                    getProcumentAndFactsheetHTML(data)
                                                                        +`
                                                                        </tr>
                                                    </tbody>
                                                </table>
                                                        
                                                <table id='email-content' class='table' width='100%' align='center' border='0' cellspacing='0' cellpadding='0' style='padding:5px 30px 0px 30px'>
                                                    <tbody style='text-align: justify'>
                                                        <tr>
                                                            <div class="card secondary mb-4 procurementApprovalDiv">
                                                            <div class="card-header hideShow">Details</div>
                                                            <div class="card-body">
                                                                <div class="container-fluid">
                                                                 <div class="form-group  row">
                                                                    <div class='col-md-12'>
                                                                     `+ data.estimation.details +`
                                                                    </div>
                                                                 </div>
                                                                   <div class="form-group  row">
                                                                        <label for="nameSupplierTextId" class="col-sm-2 col-form-label-sm control-label">Time Period :</label>
                                                                        <div class="col-sm-3">
                                                                            From: <strong>` +
                                                                            data.estimation.planStartDate +
                                                                            `</strong> To: <strong>` +
                                                                            data.estimation.planEndDate +
                                                                            `</strong>
                                                                        </div>
                                                                    </div>
                                                                             <div class="form-group  row">
                                                                                <label for="" class="col-sm-2 col-form-label-sm control-label">Currency Type :</label>
                                                                                <div class="col-sm-3">
                                                                                  <b>  `+ data.estimation.currencyTypeText + `</b>
                                                                                </div>
                                                                            </div>
                                                                    <div class="form-group  row">
                                                                        <label for="" class="col-sm-2 col-form-label-sm control-label">Total Price :</label>
                                                                        <div class="col-sm-3">
                                                                            `+ data.estimation.totalPrice  +`
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group  row">
                                                                        <label for="" class="col-sm-2 col-form-label-sm control-label">Remarks:</label>
                                                                        <div class="col-sm-9">
                                                                          <textarea class="form-control" id="" aria-label="With textarea" disabled>`+ $("#total_price_remarks").val() +`</textarea>
                                                                        </div>
                                                                    </div>
                                                                   
                                                                </div>
                                                            </div>
                                                        </div>
                                                                
                                                        </tr>
                                                        
                                                    </tbody>
                                                </table>
                                                <table id='email-content' width='100%' align='center' border='0' cellspacing='0' cellpadding='0' style='padding:5px 30px 0px 30px'>
                                                    <tbody style='text-align: justify'>
                                                        ` +
                    itemsAndtheirSummaries +
                    `<tr>
                                                            <td style='width:100%;padding:5px'>
                                                                <table align='center' border='0' cellspacing='0' cellpadding='0' style='width:100%'>
                                                                    <tbody>
                                                                        <tr><td colspan='16' style='background-color:rgba(0,0,0,0);'><br><br></td></tr>
                                                                    </tbody>
                                                                </table>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td style='padding:5px; background-color:#d4dcd0; width:100%;font-family:Calibri; font-size:100%;' align='center'>
                                                                <b>Approver List</b>
                                                                <hr>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td style='padding-bottom:30px 0px 0px 0px; width: 100%; background-color:#ededed;'>
                                                                <table align='center' border='0' cellspacing='0' cellpadding='0' style='width:100%'>
                                                                    <tr align='center'>
                                                                        <td><b><u>Approver Name</u></b></td>
                                                                        <td><b><u>Priority</u></b></td>
                                                                        <td><b><u>Department</u></b></td>
                                                                        <td><b><u>Expected Time</u></b></td>
                                                                    </tr>
                                                                    ` +
                    buildApproverTable +
                    `
                                                                </table>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>`);

                $('#ApprovalPreviewModal').modal('show');
                return;
            }

            function getProcumentAndFactsheetHTML(procumentOrFactsheet) {
                var procumentOrFactsheetHtml = "";

                if (Number(procumentOrFactsheet.estimation.estimateType) == 8 || Number(procumentOrFactsheet.estimation.estimateType) == 7) {
                    console.log('Inside procument condition');
                    procumentOrFactsheetHtml = `<div class="card secondary mb-4 procurementApprovalDiv">
                                <div class="card-header hideShow"><b>Background</b></div>
                                <div class="card-body">
                                    <div class="container-fluid">
                                        <div class="form-group  row">
                                            <label for="paReferenceNumberTextId" class="col-sm-2 col-form-label-sm control-label">PA. Reference No.</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" value="`+ procumentOrFactsheet.procurementApprovalRequest.pAReferenceNo + `" id="paReferenceNumberTextId" disabled />
                                            </div>
                                        </div>
                                        <div class="form-group  row">
                                            <label for="titleOfPRorRFQTextId" class="col-sm-2 col-form-label-sm control-label">Title of the PR/RFQ</label>
                                            <div class="col-sm-10">
                                                <input type="text" value="`+ procumentOrFactsheet.procurementApprovalRequest.titleOfPRorRFQ + `" class="form-control" id="titleOfPRorRFQTextId" disabled />
                                            </div>
                                        </div>
                                        <div class="form-group  row">
                                            <label for="RFQReferNoTextId" class="col-sm-2 col-form-label-sm control-label">RFQ Reference No.</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="RFQReferNoTextId" value="`+ procumentOrFactsheet.procurementApprovalRequest.rFQReferenceNo + `" disabled />
                                            </div>
                                        </div>
                                        <div class="form-group  row">
                                            <label for="PRReferenceNoTextId" class="col-sm-2 col-form-label-sm control-label">PR Reference No.</label>
                                            <div class="col-sm-10">
                                                        <input type="text" class="form-control" value="`+ procumentOrFactsheet.procurementApprovalRequest.pRReferenceNo + `" id="PRReferenceNoTextId" disabled />
                                            </div>
                                        </div>
                                        <div class="form-group  row">
                                            <label for="NameAndCellRequesterTextId" class="col-sm-2 col-form-label-sm control-label">Name and Cell No. of Requester</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" value="`+ procumentOrFactsheet.procurementApprovalRequest.nameOfRequester + `" id="nameAndCellRequesterTextId" disabled />
                                            </div>
                                        </div>
                                        <div class="form-group  row">
                                            <label for="deptOrDivTextId" class="col-sm-2 col-form-label-sm control-label">Department/Division</label>
                                            <div class="col-sm-10">
                                                                <input type="text" class="form-control" value="`+ $("#deptOrDivTextId option:selected").text() + `" id="departmentId" disabled />
                                            </div>
                                        </div>
                                        <div class="form-group  row">
                                            <label for="RFQProcessTextId" class="col-sm-2 col-form-label-sm control-label">RFQ Process</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="RFQProcessTextId" value="`+ procumentOrFactsheet.procurementApprovalRequest.rFQProcess + `" disabled />
                                            </div>
                                        </div>
                                        <div class="form-group  row">
                                            <label for="sourcingMethodTextId" class="col-sm-2 col-form-label-sm control-label">Sourcing Method</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" value="`+ procumentOrFactsheet.procurementApprovalRequest.sourcingMethod + `" id="sourcingMethodTextId" disabled />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card secondary mb-4 procurementApprovalDiv">
                                <div class="card-header hideShow"><b>Award Recommandation</b></div>
                                <div class="card-body">
                                    <div class="container-fluid">
                                        <div class="form-group  row">
                                            <label for="nameSupplierTextId" class="col-sm-2 col-form-label-sm control-label">Name of the Recommended Supplier</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" value="`+ procumentOrFactsheet.procurementApprovalRequest.nameOfRecommendedSupplier + `" id="nameSupplierTextId" disabled />
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="purchaseValueTextId" class="col-sm-2 col-form-label-sm">Purchase Value</label>
                                            <div class="col-sm-10">
                                                <textarea class="form-control" id="purchaseValueTextId" style="height:100px;" aria-label="With textarea" disabled> `+ procumentOrFactsheet.procurementApprovalRequest.purchaseValue + `</textarea>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="savingAmountTextId" class="col-sm-2 col-form-label-sm">Saving Amount</label>
                                            <div class="col-sm-10">
                                                <textarea class="form-control" id="savingAmountTextId" style="height:100px;" aria-label="With textarea"disabled>` + procumentOrFactsheet.procurementApprovalRequest.savingAmount + `</textarea>
                                            </div>
                                        </div>
                                        <div class="form-group  row">
                                            <label for="savingTypeDropDown" class="col-sm-2 col-form-label-sm control-label">Saving Type</label>
                                             <div class="col-sm-10">
                                                                <input type="text" class="form-control" value="`+ $("#savingTypeDropDown option:selected").text() + `" id="departmentId" disabled />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                    return procumentOrFactsheetHtml;
                } else {
                    return procumentOrFactsheetHtml;
                }

            }

            //final submit
            $("#finalSubmit").click(function() {
                showErrorMessageBelowCtrl('employeeListforApprover', 'please select Approver For this Approval', false);
                var result = validationCheck();
                console.log(result);
                if (result == false) {
                    return;
                }

                var dataFromHTML = ConstructEstimationObjectFromHTML();
                if (dataFromHTML == false)
                    return;

                var estimationAttachment = [];
                formData = new FormData();
                for (var i = 0; i < filelist.length; i++) {
                    if (jQuery.isEmptyObject(filelist[i])) {
                        console.log("skip");
                        continue;
                    }
                    formData.append(filelist[i].name, filelist[i]);
                }
                estimationAttachment = formData;

                var estimationForUpdate = {};
                var tvalue = tableOpen == 1 ? parseFloat($("#sumOfTotalPrice").text()) : parseFloat($("#totalPriceText").val());
                estimationForUpdate = {
                    EstimateId: estimationId,
                    estimateType: $("#approvalForDropDown").children("option:selected").val(),
                    currencyType: $("#currencyTypeDropDown").children("option:selected").val(),
                    subject: $("#subjectTextId").val(),
                    objective: $("#objectiveTextId").val(),
                    details: $("#textEditorEstimation").val(),
                    planStart: $("#datetimepickerEstimationStartDate").val(),
                    planEnd: $("#datetimepickerEstimationEndDate").val(),
                    totalPrice: tvalue,
                    totalPriceRemarks: $("#total_price_remarks").val()
                };
                
                console.log('estimationForUpdate : ');
                console.log(estimationForUpdate);

                var dataFromHTML = ConstructEstimationObjectFromHTML();

                var data =
                {
                    estimationId: estimationId,
                    estimationStatus: 2,
                    budgetEstimationUpdateRequest: estimationForUpdate,
                    attachmentsToRemove: filetoDeleteFromDB,
                    reAddBudgetDetailsAndOthers: dataFromHTML
                };

                console.log(data);
                AJAXCALLtoPOST(data, estimationAttachment);

            });

            function AJAXCALLtoPOST(data, estimationAttachment) {
                var dataJson = JSON.stringify(data);
                var postData = {
                    "dto": dataJson
                };
                $.ajax({
                    type: "POST",
                    traditional: true,
                    async: false,
                    cache: false,
                    url: "/DraftedBudgeEstimation/ReStructedEstimation",
                    context: document.body,
                    data: postData,
                    beforeSend: function() {
                        $.blockUI({
                            timeout: 0,
                            message: 'Processing..'
                        });
                    },
                    success: function(response) {
                        console.log('1');
                        if (parseInt(response) > 0) {
                            $.ajax({
                                type: "POST",
                                url: "/BudgetEstimation/UploadFilesOfEstimation?estimationId=" + estimationId,
                                contentType: false,
                                processData: false,
                                data: estimationAttachment,
                                async: false,
                                success: function(message) {
                                    console.log('4');
                                    $.unblockUI();
                                    if (data.estimationStatus == 2)
                                        alertify.alert('SUCCESS', 'Budget has been added Successfully!', function() { window.location = "/BudgetEstimation/DraftList"; });
                                    else if (data.estimationStatus == 5)
                                        alertify.alert('SUCCESS', 'Draft Saved Successfully!', function() { window.location = "/BudgetEstimation/DraftList"; });
                                },
                                error: function() {
                                    alertify.alert('Something went wrong!.');
                                }
                            });
                        } else {
                            alertify.alert('Something went wrong! please try again.');
                        }
                    },
                    complete: function() {
                        $.unblockUI();
                    },
                    failure: function(response) {
                        $.unblockUI();
                        alert(response.responseText);
                    },
                    error: function(response) {
                        $.unblockUI();
                        alert(response.responseText);
                    }
                });
            }

            //draft
            $("#draftBudgeEstimation").click(function() {
                showErrorMessageBelowCtrl('employeeListforApprover', 'please select Approver For this Approval', false);
                var result = validationCheck();
                console.log(result);
                if (result == false) {
                    return;
                }

                var dataFromHTML = ConstructEstimationObjectFromHTML();
                if (dataFromHTML == false)
                    return;

                var estimationAttachment = [];
                formData = new FormData();
                for (var i = 0; i < filelist.length; i++) {
                    if (jQuery.isEmptyObject(filelist[i])) {
                        console.log("skip");
                        continue;
                    }
                    formData.append(filelist[i].name, filelist[i]);
                }
                estimationAttachment = formData;

                var estimationForUpdate = {};
                var tvalue = tableOpen == 1 ? parseFloat($("#sumOfTotalPrice").text()) : parseFloat($("#totalPriceText").val());
                estimationForUpdate = {
                    EstimateId: estimationId,
                    estimateType: $("#approvalForDropDown").children("option:selected").val(),
                    currencyType: $("#currencyTypeDropDown").children("option:selected").val(),
                    subject: $("#subjectTextId").val(),
                    objective: $("#objectiveTextId").val(),
                    details: $("#textEditorEstimation").val(),
                    planStart: $("#datetimepickerEstimationStartDate").val(),
                    planEnd: $("#datetimepickerEstimationEndDate").val(),
                    totalPrice: tvalue,
                    totalPriceRemarks: $("#total_price_remarks").val()
                };

                var dataFromHTML = ConstructEstimationObjectFromHTML();

                var data =
                {
                    estimationId: estimationId,
                    estimationStatus: 5,
                    budgetEstimationUpdateRequest: estimationForUpdate,
                    attachmentsToRemove: filetoDeleteFromDB,
                    reAddBudgetDetailsAndOthers: dataFromHTML
                };

                console.log(data);
                AJAXCALLtoPOST(data, estimationAttachment);
            });

            function Response(estimation, estimateApproverList, estimateDetails, departmentWiseSummaryList, particularWiseSummaryList, procurementApprovalRequest) {
                this.estimation = estimation;
                this.estimateApproverList = estimateApproverList;
                this.estimateDetails = estimateDetails;
                this.departmentWiseSummary = departmentWiseSummaryList;
                this.particularWiseSummary = particularWiseSummaryList;
                this.procurementApprovalRequest = procurementApprovalRequest;
            }

            function setValuesOnItemCodeAndItemUnitTextAndUnitPrice(rowTrackId, flag) {
                $("#itemCodeTextId" + rowTrackId).html(storeItemDetails[flag]['itemCode']);
                $("#itemUnitTextId" + rowTrackId).html(storeItemDetails[flag]['unitName']);
                $("#unitPriceTextId" + rowTrackId).val(storeItemDetails[flag]['indicatingUnitPrice']);
            }

            function setDefaultDataOnMultipleSpanAndTextBoxOnParticularTable(rowTrackId) {
                $("#itemCodeTextId" + rowTrackId).html(0);
                $("#itemUnitTextId" + rowTrackId).html(0);
                $("#unitPriceTextId" + rowTrackId).val(0);
                $("#TotalPriceTextId" + rowTrackId).text(0);

                $("#NoOfMaUTCaTextId" + rowTrackId).val(0);
                $("#NoOfDTUTextId" + rowTrackId).val(0);
                $("#requiredQuantityTextId" + rowTrackId).val(0);
                getSumOfTotalPrice();
            }

            //calculation of total price
            function calculateTotalPrice(rowTrackId) {
                var multi = 1;
                $(".singleRowFindTotalPrice" + rowTrackId).each(function() {
                    if (!isNaN(this.value) && this.value.length != 0 && this.value != 0) {
                        multi = multi * parseFloat(this.value);
                    }
                });
                multi = multi * $("#unitPriceTextId" + rowTrackId).val();
                $("#TotalPriceTextId" + rowTrackId).text(multi.toFixed(2));
                var formatter = new Intl.NumberFormat('en-IN');
                $("#TotalPriceFormateTextId" + rowTrackId).text(formatter.format(multi.toFixed(2)));
                getSumOfTotalPrice();
            }

            //get sumation of total price
            function getSumOfTotalPrice() {
                var sum = 0;
                $('.particularItemsAndDetailsTable tr').each(function(a, b) {

                    var totalPrice = $('.totalPriceColumn', b).text();
                    if (!isNaN(totalPrice) && totalPrice.length != 0) {
                        sum += parseFloat(totalPrice);
                    }
                });

                $("#sumOfTotalPrice").text(sum.toFixed(2));
                var formatter = new Intl.NumberFormat('en-IN',
                    {
                        style: 'currency',
                        currency: 'BDT'
                    });
                $('#sumOfTotalPriceShow').text(formatter.format(sum.toFixed(2)));
                getParticularSummary();
                getDepartmentSummary();
            }

            //....................... Particular Summary
            //................................
            //.... getting Particular summary
            function getParticularSummary() {

                var particularTableArray = [];
                $('.particularItemsAndDetailsTable tr').each(function(a, b) {
                    var particularName = $('.particularSelectorFromTable', b).find(":selected").text().trim();
                    var particularId = $('.particularSelectorFromTable', b).find(":selected").val()
                    var totalPrice = $('.totalPriceColumn', b).text();
                    if (particularId == "-1") {
                        console.log("not selected");
                    } else {
                        if (particularName.length > 0) {
                            particularTableArray.push({
                                ParticularName: particularName,
                                ParticularId: particularId,
                                TotalPrice: totalPrice
                            });
                        }
                    }
                });

                var result = [];
                particularTableArray.reduce(function(res, value) {
                        if (!res[value.ParticularName]) {
                            res[value.ParticularName] = {
                                TotalPrice: 0,
                                ParticularId: value.ParticularId,
                                ParticularName: value.ParticularName
                            };
                            result.push(res[value.ParticularName])
                        }
                        res[value.ParticularName].TotalPrice = parseFloat(value.TotalPrice) + parseFloat(res[value.ParticularName].TotalPrice);
                        return res;
                    },
                    {});

                removeTableRows();
                var rowParticularSummaryTableIndex = 1;
                for (var x = 0; x < result.length; x++) {
                    addingRowInParticularSummaryTable(rowParticularSummaryTableIndex,
                        result[x].ParticularName,
                        result[x].ParticularId,
                        result[x].TotalPrice.toFixed(2));
                    rowParticularSummaryTableIndex++;
                }
            }

            //adding a row in Particular summary table
            function addingRowInParticularSummaryTable(rowParticularSummaryTableIndex, name, particularId, value) {
                var formatter = new Intl.NumberFormat('en-IN',
                    {
                        style: 'currency',
                        currency: 'BDT'
                    });

                $('#tPartiSummarybody').append(
                    `<tr class="deletedParticularRow" id="RowParticularSummary${rowParticularSummaryTableIndex}">
                        <td lass="text-left">
                            <span id="nameParticularId${rowParticularSummaryTableIndex}" style="color:chocolate">` +
                    name +
                    `</span>
                        <td id="idParticularId${rowParticularSummaryTableIndex}" hidden>` +
                    particularId +
                    `</td>
                        </td>
                        <td class="text-right">
                            <span id="totalPriceParticularId${rowParticularSummaryTableIndex}" hidden>` +
                    value +
                    `</span>
                            <span style="color:chocolate">` +
                    formatter.format(value) +
                    `</span>
                        </td>
                    </tr>`
                );
            }

            function removeTableRows() {
                $('.deletedParticularRow').remove();
            }

            //...................... DeartmentWisye Summary
            //.................................
            //.... getting Department summary
            function getDepartmentSummary() {
                var departmentTableArray = [];
                $('.particularItemsAndDetailsTable tr').each(function(a, b) {
                    var department = $('.departmentSelector', b).find(":selected").text().trim();
                    var departmentId = $('.departmentSelector', b).find(":selected").val()
                    var totalPrice = $('.totalPriceColumn', b).text();
                    if (departmentId == "-1") {
                        console.log("not selected");
                    } else {
                        var totalPrice = $('.totalPriceColumn', b).text();
                        if (department.length > 0) {
                            departmentTableArray.push({
                                DepartmentName: department,
                                DepartmentID: departmentId,
                                TotalPrice: totalPrice
                            });
                        }
                    }
                });

                var result = [];
                departmentTableArray.reduce(function(res, value) {
                        if (!res[value.DepartmentName]) {
                            res[value.DepartmentName] = {
                                TotalPrice: 0,
                                DepartmentID: value.DepartmentID,
                                DepartmentName: value.DepartmentName
                            };
                            result.push(res[value.DepartmentName])
                        }
                        res[value.DepartmentName].TotalPrice = parseFloat(value.TotalPrice) + parseFloat(res[value.DepartmentName].TotalPrice);
                        return res;
                    },
                    {});
                //adding row from result data
                removeDepartmentWiseSummmaryTableRows();
                var rowDepartmentWiseSummaryTableIndex = 1;
                for (var x = 0; x < result.length; x++) {
                    addingRowInDepartmentSummaryTable(rowDepartmentWiseSummaryTableIndex, result[x].DepartmentName, result[x].DepartmentID, result[x].TotalPrice.toFixed(2));
                    rowDepartmentWiseSummaryTableIndex++;
                }
            }

            //adding a row in Department summary table
            function addingRowInDepartmentSummaryTable(rowDepartmentWiseSummaryTableIndex, name, deptId, value) {
                var formatter = new Intl.NumberFormat('en-IN',
                    {
                        style: 'currency',
                        currency: 'BDT'
                    });

                $('#tDepartSummarybody').append(
                    `<tr class="deletedDepartmentRow" id="RowParticularSummary${rowDepartmentWiseSummaryTableIndex}">
                            <td lass="text-left">
                                <span id="nameDepartmentId${rowDepartmentWiseSummaryTableIndex}"
                                    class="departmentWiserSummaryDepartmentColumn"
                                    style="color:chocolate">` +
                    name +
                    `</span>
                            </td>
                            <td id="idDepartmentId${rowDepartmentWiseSummaryTableIndex}" class="departmentSummaryDeptId" hidden>` +
                    deptId +
                    `</td>
                            <td class="text-right">
                                <span id="totalPriceDepartmentId${rowDepartmentWiseSummaryTableIndex}"
                                    class="departmentWiserSummaryTablePriceColumn" hidden>` +
                    value +
                    `</span>
                                <span style="color:chocolate">` +
                    formatter.format(value) +
                    `</span>
                            </td>
                        </tr>`
                );
            }

            function removeDepartmentWiseSummmaryTableRows() {
                $('.deletedDepartmentRow').remove();
            }

            function getUserWithDepartmentNameSelect2FromDb() {
                $.ajax({
                    type: "GET",
                    url: "/User/GetAllUsersWithDepartmentName",
                    data: "{}",
                    success: function(data) {
                        var users = data.users;
                        storeUsersWithDepartmentName = users;

                        for (var i = 0; i < users.length; i++) {
                            var o = new Option(users[i].fullName, users[i].userID);
                            $(o).html(users[i].fullName + "/ " + users[i].departmentName);
                            $("#employeeListforApprover").append(o);
                        }
                    }
                });
            }

            function getEstimateTypeFromDb() {
                $.ajax({
                    type: "GET",
                    url: "/EstimateType/GetAllEstimateTypes",
                    data: "{}",
                    success: function(data) {
                        var estimateType = data.estimateTypes;
                        for (var i = 0; i < estimateType.length; i++) {
                            if (estimateType[i].id == selectValue)
                                continue;
                            var o = new Option(estimateType[i].name, estimateType[i].id);
                            $(o).html(estimateType[i].name);
                            $("#approvalForDropDown").append(o);
                        }
                    }
                });
            }


            function getCurrencyTypeFromDbBasedOnEstimationTypeAndDropdownName(dropdownName, estimationType) {

                var data = { "dropdownName": dropdownName, "estimateType": estimationType };
                $("#currencyTypeDropDown").html("");

                $.ajax({
                    type: "GET",
                    url: "/EstimateType/GetAllDropdownItemByDropdownNameAndEstimateType",
                    data: data,
                    success: function (data) {
                        console.log('Currency type dropdown ==============================');
                        console.log(data);
                        var currencyType = data;
                        for (var i = 0; i < currencyType.length; i++) {
                            if (Number(currencyType[i].isDefaultSelected) == 1) {
                                console.log('select dropdown');
                                var o = new Option(currencyType[i].name, currencyType[i].value, true, true);
                            } else {
                                var o = new Option(currencyType[i].name, currencyType[i].value);
                            }

                            $(o).html(currencyType[i].name);
                            $("#currencyTypeDropDown").append(o);
                        }
                    }
                });
            }
        });
    </script>
}

}